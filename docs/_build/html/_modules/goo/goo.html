<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>goo.goo &mdash; Goo 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f2f2f2" >
            <a href="../../index.html">
            <img src="../../_static/goo_logo_web.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/installation.html#simulation-scripts">Simulation scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/installation.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/purpose.html">Purpose and intented usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/modules.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html"><code class="docutils literal notranslate"><span class="pre">Force</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.Force.force_list"><code class="docutils literal notranslate"><span class="pre">Force.force_list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.Force.get_blender_force"><code class="docutils literal notranslate"><span class="pre">Force.get_blender_force()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.Force.get_falloff"><code class="docutils literal notranslate"><span class="pre">Force.get_falloff()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.Force.get_strength"><code class="docutils literal notranslate"><span class="pre">Force.get_strength()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_boundaries"><code class="docutils literal notranslate"><span class="pre">add_boundaries()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_hetero_adhesion"><code class="docutils literal notranslate"><span class="pre">add_hetero_adhesion()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_homo_adhesion"><code class="docutils literal notranslate"><span class="pre">add_homo_adhesion()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_material"><code class="docutils literal notranslate"><span class="pre">add_material()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_motion"><code class="docutils literal notranslate"><span class="pre">add_motion()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.add_world_HDRI"><code class="docutils literal notranslate"><span class="pre">add_world_HDRI()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.apply_modifiers"><code class="docutils literal notranslate"><span class="pre">apply_modifiers()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.apply_physics"><code class="docutils literal notranslate"><span class="pre">apply_physics()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.calculate_com"><code class="docutils literal notranslate"><span class="pre">calculate_com()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.calculate_volume"><code class="docutils literal notranslate"><span class="pre">calculate_volume()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.cast_to_sphere"><code class="docutils literal notranslate"><span class="pre">cast_to_sphere()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.constrict"><code class="docutils literal notranslate"><span class="pre">constrict()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.declare_cloth_settings"><code class="docutils literal notranslate"><span class="pre">declare_cloth_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.declare_collision_settings"><code class="docutils literal notranslate"><span class="pre">declare_collision_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.declare_remesh_settings"><code class="docutils literal notranslate"><span class="pre">declare_remesh_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.declare_subsurf_settings"><code class="docutils literal notranslate"><span class="pre">declare_subsurf_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.disable_internal_springs"><code class="docutils literal notranslate"><span class="pre">disable_internal_springs()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.divide_boolean"><code class="docutils literal notranslate"><span class="pre">divide_boolean()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_cells_same_type"><code class="docutils literal notranslate"><span class="pre">get_cells_same_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_centerofmass"><code class="docutils literal notranslate"><span class="pre">get_centerofmass()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_contact_area"><code class="docutils literal notranslate"><span class="pre">get_contact_area()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_division_angles"><code class="docutils literal notranslate"><span class="pre">get_division_angles()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_forces_in_collection"><code class="docutils literal notranslate"><span class="pre">get_forces_in_collection()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_forces_same_type"><code class="docutils literal notranslate"><span class="pre">get_forces_same_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_line_angles"><code class="docutils literal notranslate"><span class="pre">get_line_angles()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_long_axis"><code class="docutils literal notranslate"><span class="pre">get_long_axis()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_long_axis_global"><code class="docutils literal notranslate"><span class="pre">get_long_axis_global()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_long_axis_np"><code class="docutils literal notranslate"><span class="pre">get_long_axis_np()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_longaxis_angles"><code class="docutils literal notranslate"><span class="pre">get_longaxis_angles()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.get_missing_adhesion_forces"><code class="docutils literal notranslate"><span class="pre">get_missing_adhesion_forces()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class"><code class="docutils literal notranslate"><span class="pre">handler_class</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.adhesion_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.adhesion_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.boundary_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.boundary_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.contact_area_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.contact_area_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.data_export_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.data_export_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.division_handler_random"><code class="docutils literal notranslate"><span class="pre">handler_class.division_handler_random()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.division_handler_volume"><code class="docutils literal notranslate"><span class="pre">handler_class.division_handler_volume()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.growth_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.growth_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.growth_pressure_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.growth_pressure_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.launch_simulation"><code class="docutils literal notranslate"><span class="pre">handler_class.launch_simulation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.motion_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.motion_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.remeshing_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.remeshing_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.stop_animation"><code class="docutils literal notranslate"><span class="pre">handler_class.stop_animation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.timing_elapsed_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.timing_elapsed_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.timing_init_handler"><code class="docutils literal notranslate"><span class="pre">handler_class.timing_init_handler()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.handler_class.visualize_stretching"><code class="docutils literal notranslate"><span class="pre">handler_class.visualize_stretching()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.make_cell"><code class="docutils literal notranslate"><span class="pre">make_cell()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.make_collection"><code class="docutils literal notranslate"><span class="pre">make_collection()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.make_force"><code class="docutils literal notranslate"><span class="pre">make_force()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.render"><code class="docutils literal notranslate"><span class="pre">render()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.setup_world"><code class="docutils literal notranslate"><span class="pre">setup_world()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.store_cloth_settings"><code class="docutils literal notranslate"><span class="pre">store_cloth_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.store_collision_settings"><code class="docutils literal notranslate"><span class="pre">store_collision_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.store_remesh_settings"><code class="docutils literal notranslate"><span class="pre">store_remesh_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.store_subsurf_settings"><code class="docutils literal notranslate"><span class="pre">store_subsurf_settings()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/goo.html#goo.goo.to_sphere"><code class="docutils literal notranslate"><span class="pre">to_sphere()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/examples.html#cleaving-cells">Cleaving cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/examples.html#homotypically-adhering-doublets">Homotypically adhering doublets</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../credits/credits_and_citation.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/credits_and_citation.html#citing-goo">Citing goo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #f2f2f2" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Goo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>goo.goo</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for goo.goo</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">mathutils</span> <span class="kn">import</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">Matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">bmesh</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Authors: Antoine Ruzette, Sean Megason.</span>
<span class="sd">Developed and maintained by the Megason Lab, 2024. </span>

<span class="sd">Sphynx docstring used for documentation. </span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="calculate_volume"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.calculate_volume">[docs]</a><span class="k">def</span> <span class="nf">calculate_volume</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the volume of the Blender mesh. </span>

<span class="sd">    In order to retrieve the mesh as it is currrently evaluated - including </span>
<span class="sd">    the effect of all modifiers - in the simulation, its corresponding evaluated </span>
<span class="sd">    ID is obtained from the dependency graph for the current context. </span>

<span class="sd">    .. seealso:: [Blender API Documentation &gt; </span>
<span class="sd">                ``evaluated_get(depsgraph)``]</span>
<span class="sd">                (https://docs.blender.org/api/current/bpy.types.ID.html?highlight=evaluated_get#bpy.types.ID.evaluated_get)</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender mesh.</span>
<span class="sd">    :returns: The volume of the mesh. </span>
<span class="sd">    :rtype: float</span>

<span class="sd">    .. note:: The function may return a negative volume. </span>
<span class="sd">                See ``calc_volume(signed=True)``. </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We need to get the cell as it is evaluated in the simulation.</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">obj_eval</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="c1"># Use BMesh to calculate volume of a mesh </span>
    <span class="n">mesh_from_eval</span> <span class="o">=</span> <span class="n">obj_eval</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">mesh_from_eval</span><span class="p">)</span>
    <span class="c1"># Apply the object&#39;s scale and dimensions to the bmesh</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">obj_eval</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span>
    <span class="c1"># Calculate volume</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">calc_volume</span><span class="p">()</span>
    <span class="c1"># Output the result</span>
    <span class="c1"># print(f&quot;Volume of {obj.name}: {abs(volume)}&quot;)</span>
    <span class="c1"># Free the bmesh</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">free</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">volume</span></div>


<div class="viewcode-block" id="get_centerofmass"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_centerofmass">[docs]</a><span class="k">def</span> <span class="nf">get_centerofmass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the center of mass of a mesh. </span>

<span class="sd">    This function fetch the evaluated object&#39;s dependency graph, </span>
<span class="sd">    retrieves the coordinates of each vertex then computes the center of mass </span>
<span class="sd">    as the mean position among the set of vertices.  </span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender mesh.</span>
<span class="sd">    :returns: The coordinates of the center of mass of the mesh as a tuple(x, y, z). </span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">obj_eval</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">obj_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">vert_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">obj_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">])</span>
    <span class="n">COM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vert_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
 
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">COM</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_long_axis_np"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_long_axis_np">[docs]</a><span class="k">def</span> <span class="nf">get_long_axis_np</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the long axis of a mesh.</span>

<span class="sd">    This function calculates the first eigenvector of the vertices in the mesh,</span>
<span class="sd">    which corresponds to the long axis.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender mesh.</span>
<span class="sd">    :returns: The coordinates of the long axis of the mesh as a tuple(x, y, z)</span>
<span class="sd">              which gives direction from the origin (0, 0, 0).</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the evaluated object and its vertices</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">evaluated_object</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">evaluated_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">vertex_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">])</span>

    <span class="c1"># Subtract the mean from each dimension</span>
    <span class="n">vertex_coords</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the covariance matrix and its eigenvectors</span>
    <span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">eigenvals</span><span class="p">,</span> <span class="n">eigenvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>
    <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">)</span>

    <span class="c1"># Get the eigenvector corresponding to the largest eigenvalue</span>
    <span class="n">long_axis</span> <span class="o">=</span> <span class="n">eigenvecs</span><span class="p">[:,</span> <span class="n">sort_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">long_axis</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_long_axis_global"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_long_axis_global">[docs]</a><span class="k">def</span> <span class="nf">get_long_axis_global</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the long axis of a 3D object in global coordinates.</span>

<span class="sd">    This function computes the long axis of a 3D object by determining the first</span>
<span class="sd">    eigenvector of its vertices&#39; positions in global coordinates.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object for which to calculate</span>
<span class="sd">                                         the long axis.</span>
<span class="sd">    :returns: A tuple representing the coordinates of the long axis in global</span>
<span class="sd">              space as (x, y, z), and the length of the long axis.</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the evaluated object and its vertices</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">evaluated_object</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>

    <span class="n">vertices</span> <span class="o">=</span> <span class="n">evaluated_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">vertex_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">])</span>
    <span class="c1"># Calculate the covariance matrix of the vertices</span>
    <span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Calculate the eigenvectors and eigenvalues of the covariance matrix</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">)</span>
    <span class="c1"># Sort the eigenvectors by descending eigenvalues</span>
    <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">eigenvalues</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="c1"># The major axis is the first eigenvector</span>
    <span class="n">major_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Convert the major axis to global coordinates</span>
    <span class="n">major_axis_global</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">major_axis</span><span class="p">,</span> 
                                                                            <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Find extreme points along the major axis</span>
    <span class="n">min_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertex_coords</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">major_axis</span><span class="p">))</span>
    <span class="n">max_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertex_coords</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">major_axis</span><span class="p">))</span>
    <span class="n">length_long_axis</span> <span class="o">=</span> <span class="n">max_point</span> <span class="o">-</span> <span class="n">min_point</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">major_axis_global</span><span class="p">)[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">length_long_axis</span></div>


<div class="viewcode-block" id="get_long_axis"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_long_axis">[docs]</a><span class="k">def</span> <span class="nf">get_long_axis</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the long axis of a mesh. </span>

<span class="sd">    This function calculates the first eigenvector of the vertices in the mesh, </span>
<span class="sd">    which corresponds to the long axis.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender mesh.</span>
<span class="sd">    :returns: The coordinates of the long axis of the mesh as a tuple(x, y, z) </span>
<span class="sd">                which gives direction from the origin (0, 0, 0). </span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We need to get the cell as it is evaluated in the simulation.</span>
    <span class="c1"># To do this, we fetch its dependency graph and obtain the</span>
    <span class="c1"># evaluated cell (denoted as obj_eval here)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">evaluated_object</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="c1"># We obtain the (x, y, z) coordinates of the vertices in the</span>
    <span class="c1"># evaluated cell</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">evaluated_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">vertex_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">]</span>
    <span class="n">vertex_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">)</span>

    <span class="c1"># We separate the x, y, and z coordinates into their own arrays.</span>
    <span class="c1"># We also subtract the mean of each dimension from the corresponding</span>
    <span class="c1"># array values (normalization). </span>
    <span class="c1"># Mesh is centered on the origin. This is part of the PCA algorithm.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">vertex_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">vertex_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">vertex_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c1"># We stack the three arrays together to make the &quot;new&quot; coordinates</span>
    <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
    <span class="c1"># This is then used to find the covariance matrix of the coordinates</span>
    <span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>
    <span class="c1"># Per the PCA algorithm, we find the eigenalues and eigenvectors</span>
    <span class="c1"># of the covariance matrix</span>
    <span class="n">eigenvals</span><span class="p">,</span> <span class="n">eigenvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>

    <span class="c1"># The eigenvalues are sorted, and the primary eigenvector</span>
    <span class="c1"># is the major axis.</span>
    <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigenvals</span><span class="p">)</span>
    <span class="n">major_x</span><span class="p">,</span> <span class="n">major_y</span><span class="p">,</span> <span class="n">major_z</span> <span class="o">=</span> <span class="n">eigenvecs</span><span class="p">[:,</span> <span class="n">sort_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">long_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">major_x</span><span class="p">,</span> <span class="n">major_y</span><span class="p">,</span> <span class="n">major_z</span><span class="p">)</span>

    <span class="c1"># We project each vertex onto the major axis and calculate</span>
    <span class="c1"># the distance between the vertex and the closest and farthest</span>
    <span class="c1"># projections. The difference between these distances is the</span>
    <span class="c1"># length of the axis contained within the mesh.</span>
    <span class="c1"># Calculate the principal components of the mesh</span>
    <span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">)</span>
    <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)]</span>
    <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">principal_axis</span><span class="p">)</span>
    <span class="n">long_axis_normalized</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">principal_axis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">principal_axis</span><span class="p">))</span>

    <span class="c1"># Find the two vertices farthest apart along the principal axis</span>
    <span class="n">vertex_distances</span> <span class="o">=</span> <span class="n">vertex_coords</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">principal_axis</span><span class="p">)</span>
    <span class="n">vertex_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">vertex_distances</span><span class="p">)</span>
    <span class="n">first_vertex</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertex_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">last_vertex</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertex_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># Calculate the length of the long axis contained in the mesh</span>
    <span class="n">long_axis_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
        <span class="p">(</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">last_vertex</span><span class="o">.</span><span class="n">co</span><span class="p">)</span> <span class="o">-</span>
        <span class="p">(</span><span class="n">evaluated_object</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">first_vertex</span><span class="o">.</span><span class="n">co</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Compute end points of the long axis</span>
    <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_vertex</span><span class="o">.</span><span class="n">co</span><span class="p">,</span> <span class="n">last_vertex</span><span class="o">.</span><span class="n">co</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">long_axis</span><span class="p">,</span> <span class="n">long_axis_normalized</span><span class="p">,</span> <span class="n">long_axis_length</span><span class="p">,</span> <span class="n">endpoints</span></div>


<div class="viewcode-block" id="get_longaxis_angles"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_longaxis_angles">[docs]</a><span class="k">def</span> <span class="nf">get_longaxis_angles</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the 2 angles associated with the long axis of a cell. </span>

<span class="sd">    :param tuple axis: Coordinates of the long axis to the division plane </span>
<span class="sd">                        as retrived by ``get_major_axis(obj)``.</span>
<span class="sd">    :returns: </span>
<span class="sd">        - phi (:py:class:`tuple`) - Phi is the angle between the division axis \</span>
<span class="sd">            and the z-axis in spherical coordinates. </span>
<span class="sd">        - theta (:py:class:`tuple`) - Theta is the angle projected on the xy plane \</span>
<span class="sd">            in cartesian 3D coordinates. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We define the unit vector of z-axis</span>
    <span class="n">z_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># We find the unit vector of the division axis</span>
    <span class="n">division_axis</span> <span class="o">=</span> <span class="n">axis</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="c1"># We calculate the dot product of the normalized</span>
    <span class="c1"># z and division axes</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">z_axis</span><span class="p">,</span> <span class="n">division_axis</span><span class="p">)</span>
    <span class="c1"># The inverse cosine of the dot product is phi</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dot_product</span><span class="p">)</span>

    <span class="c1"># The first step to find theta is to find the projection</span>
    <span class="c1"># of the division axis on the z axis</span>
    <span class="n">proj_axis_on_z</span> <span class="o">=</span> <span class="n">dot_product</span><span class="o">*</span><span class="n">z_axis</span>
    <span class="c1"># This projection is subtracted from the division axis</span>
    <span class="c1"># To find the projection on the xy-plane</span>
    <span class="n">proj_xy_axis</span> <span class="o">=</span> <span class="n">division_axis</span> <span class="o">-</span> <span class="n">proj_axis_on_z</span>
    <span class="c1"># We normalize this projection</span>
    <span class="n">proj_xy_axis</span> <span class="o">=</span> <span class="n">proj_xy_axis</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">proj_xy_axis</span><span class="p">)</span>
    <span class="c1"># We take the dot product of the x-axis and the normalized projection</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">proj_xy_axis</span><span class="p">)</span>
    <span class="c1"># The inverse cosin of this dot product is theta.</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dot_product</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Division angles:(phi=</span><span class="si">{</span><span class="n">phi</span><span class="si">}</span><span class="s1">; theta=</span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span></div>


<div class="viewcode-block" id="get_line_angles"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_line_angles">[docs]</a><span class="k">def</span> <span class="nf">get_line_angles</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the angles between a line and the global axes.</span>

<span class="sd">    This function calculates the angles between a line defined by two points</span>
<span class="sd">    (p1 and p2) and each of the global axes (x, y, z) of the given Blender cell.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] cell: The Blender object representing the cell.</span>
<span class="sd">    :param tuple p1: The coordinates of the first point of the line.</span>
<span class="sd">    :param tuple p2: The coordinates of the second point of the line.</span>
<span class="sd">    :returns: Angles between the line and each global axis in radians.</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate the direction vectors of the global axes</span>
    <span class="n">x_dir</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">@</span> <span class="n">cell</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="n">y_dir</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">@</span> <span class="n">cell</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="n">z_dir</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">cell</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

    <span class="c1"># Get the vector representing the line</span>
    <span class="n">line_vector</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

    <span class="c1"># Calculate the angles between the line and each axis</span>
    <span class="c1"># 90 is added to get the orthogonal</span>
    <span class="n">x_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">line_vector</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_dir</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">y_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">line_vector</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y_dir</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">z_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">line_vector</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">z_dir</span><span class="p">))))</span>

    <span class="k">return</span> <span class="n">x_angle</span><span class="p">,</span> <span class="n">y_angle</span><span class="p">,</span> <span class="n">z_angle</span></div>

 
<div class="viewcode-block" id="apply_modifiers"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.apply_modifiers">[docs]</a><span class="k">def</span> <span class="nf">apply_modifiers</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply modifiers to a Blender object.</span>

<span class="sd">    This function applies modifiers to a Blender object, either all modifiers or</span>
<span class="sd">    a specific one, based on the &#39;which&#39; parameter.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object to which modifiers</span>
<span class="sd">                                         should be applied.</span>
<span class="sd">    :param str which: Specifies which modifier(s) to apply. Default is &#39;all&#39;.</span>
<span class="sd">                     If &#39;all&#39;, all modifiers are applied; otherwise, specify the</span>
<span class="sd">                     name of the specific modifier to apply.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span> 
        <span class="n">modifiers_to_apply</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span>

        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">modifiers_to_apply</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Check if the specified modifier exists in the object&#39;s modifiers</span>
        <span class="k">if</span> <span class="n">which</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">which</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modifier &#39;</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s2">&#39; not found in object &#39;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="get_forces_in_collection"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_forces_in_collection">[docs]</a><span class="k">def</span> <span class="nf">get_forces_in_collection</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get forces associated to the same cell.</span>

<span class="sd">    This function retrieves force objects within the same collection as the provided</span>
<span class="sd">    Blender object that have a tag &#39;object&#39; with the value &#39;force&#39;.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object whose collection</span>
<span class="sd">                                         is used for searching forces.</span>
<span class="sd">    :returns: A list of objects within the same collection tagged as &#39;force&#39;.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">forces</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">all_objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span>
        <span class="p">):</span> 
            <span class="n">forces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">forces</span></div>


<div class="viewcode-block" id="get_cells_same_type"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_cells_same_type">[docs]</a><span class="k">def</span> <span class="nf">get_cells_same_type</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get cells of the same type.</span>

<span class="sd">    This function retrieves cells of the same type as the provided Blender</span>
<span class="sd">    object, and looks across different collections. Checks the `type` custom properties </span>
<span class="sd">    of a Blender object. </span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object representing a cell.</span>
<span class="sd">    :returns: A list of cell Blender object of the same type.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cells_same_type</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">coll</span><span class="o">.</span><span class="n">all_objects</span><span class="p">:</span> 
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span> <span class="ow">and</span> 
                <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> 
                <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="n">cell</span> <span class="o">!=</span> <span class="n">obj</span>
            <span class="p">):</span> 
                <span class="c1"># Split the names into root and subsequent divisions</span>
                <span class="c1"># Naming by convention here</span>
                <span class="n">cell_root</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">obj_root</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Compare roots to exclude cells with similar </span>
                <span class="c1"># roots but different subsequent divisions</span>
                <span class="k">if</span> <span class="n">cell_root</span> <span class="o">!=</span> <span class="n">obj_root</span><span class="p">:</span>
                    <span class="n">cells_same_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cells_same_type</span></div>


<div class="viewcode-block" id="get_forces_same_type"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_forces_same_type">[docs]</a><span class="k">def</span> <span class="nf">get_forces_same_type</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get cells of the same type.</span>

<span class="sd">    This function retrieves forces of the same type as the provided Blender</span>
<span class="sd">    object, and looks across different collections. Checks the `type` custom properties </span>
<span class="sd">    of a Blender object, but outputs the associated force. </span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object representing a cell.</span>
<span class="sd">    :returns: A list of force Blender object of the same type.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">forces_same_type</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">coll</span><span class="o">.</span><span class="n">all_objects</span><span class="p">:</span> 
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span> <span class="ow">and</span> 
                <span class="n">force</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> 
                <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="n">force</span> <span class="o">!=</span> <span class="n">obj</span>
            <span class="p">):</span> 
                <span class="c1"># Split the names into root and subsequent divisions</span>
                <span class="c1"># Naming by convention here</span>
                <span class="n">cell_root</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">obj_root</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Compare roots to exclude cells with similar </span>
                <span class="c1"># roots but different subsequent divisions</span>
                <span class="k">if</span> <span class="n">cell_root</span> <span class="o">!=</span> <span class="n">obj_root</span><span class="p">:</span>
                    <span class="n">forces_same_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">forces_same_type</span></div>


<div class="viewcode-block" id="get_missing_adhesion_forces"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_missing_adhesion_forces">[docs]</a><span class="k">def</span> <span class="nf">get_missing_adhesion_forces</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get adhesion forces missing between two objects.</span>

<span class="sd">    This function identifies adhesion forces missing between two Blender objects.</span>
<span class="sd">    Adhesion forces are objects tagged with &#39;object&#39; equal to &#39;force&#39; and &#39;motion&#39;</span>
<span class="sd">    equal to 0. It enforces daughter cells to inherit all adhesion forces </span>
<span class="sd">    from their cell type.  </span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj1: The first Blender object.</span>
<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj2: The second Blender object.</span>
<span class="sd">    :returns: A list of adhesion forces missing between the two objects.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">forces_obj1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obj1</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">all_objects</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span> <span class="ow">and</span> 
            <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">forces_obj2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obj2</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">all_objects</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span> <span class="ow">and</span> 
            <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">missing_adhesion_forces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">forces_obj1</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">forces_obj2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">missing_adhesion_forces</span></div>


<span class="sd">&#39;&#39;&#39;def gather_modifier_info(obj):</span>
<span class="sd">    modifiers_info = []</span>
<span class="sd">    for modifier in obj.modifiers:</span>
<span class="sd">        modifier_data = {&#39;type&#39;: modifier.type, &#39;name&#39;: modifier.name}</span>
<span class="sd">        # Store modifier parameters</span>
<span class="sd">        for prop in modifier.bl_rna.properties:</span>
<span class="sd">            if prop.identifier != &#39;rna_type&#39; and not prop.is_readonly:</span>
<span class="sd">                # Handling nested properties for collision_settings</span>
<span class="sd">                if prop.identifier == &#39;collision_settings&#39;: </span>
<span class="sd">                    collision_settings = {}</span>
<span class="sd">                    for collision_prop in prop.type.bl_rna.properties:</span>
<span class="sd">                        if (collision_prop.identifier != &#39;rna_type&#39; </span>
<span class="sd">                                and not collision_prop.is_readonly):</span>
<span class="sd">                            collision_settings[collision_prop.identifier] = \</span>
<span class="sd">                                getattr(getattr(modifier, prop.identifier),</span>
<span class="sd">                                        collision_prop.identifier)</span>
<span class="sd">                    modifier_data[prop.identifier] = collision_settings</span>
<span class="sd">                # Handling cloth modifier settings</span>
<span class="sd">                elif prop.identifier == &#39;settings&#39; and modifier.type == &#39;CLOTH&#39;:</span>
<span class="sd">                    cloth_settings = {}</span>
<span class="sd">                    for cloth_prop in prop.type.bl_rna.properties:</span>
<span class="sd">                        if (cloth_prop.identifier != &#39;rna_type&#39; </span>
<span class="sd">                                and not cloth_prop.is_readonly):</span>
<span class="sd">                            cloth_settings[cloth_prop.identifier] = \</span>
<span class="sd">                                getattr(getattr(modifier, prop.identifier), </span>
<span class="sd">                                        cloth_prop.identifier)</span>
<span class="sd">                    modifier_data[prop.identifier] = cloth_settings</span>
<span class="sd">                else:</span>
<span class="sd">                    modifier_data[prop.identifier] = getattr(modifier, prop.identifier)</span>
<span class="sd">        modifiers_info.append(modifier_data)</span>
<span class="sd">    return modifiers_info&#39;&#39;&#39;</span>


<div class="viewcode-block" id="store_subsurf_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.store_subsurf_settings">[docs]</a><span class="k">def</span> <span class="nf">store_subsurf_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store Subdivision Surface (Subsurf) modifier settings.</span>

<span class="sd">    This function stores the settings of Subsurf modifiers applied to a Blender</span>
<span class="sd">    object, including subdivision type, levels, and quality.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object containing </span>
<span class="sd">                                         Subsurf modifiers.</span>
<span class="sd">    :returns: A dictionary storing Subsurf modifier settings for each modifier.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subsurf_settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;SUBSURF&#39;</span><span class="p">:</span>
            <span class="n">subsurf_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;subdivision_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">modifier</span><span class="p">):</span>
                <span class="n">subsurf_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;subdivision_type&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">modifier</span><span class="o">.</span><span class="n">subdivision_type</span>
            <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">modifier</span><span class="p">):</span>
                <span class="n">subsurf_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">levels</span>
            <span class="k">if</span> <span class="s1">&#39;quality&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">modifier</span><span class="p">):</span>
                <span class="n">subsurf_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">quality</span>
    <span class="k">return</span> <span class="n">subsurf_settings</span></div>


<div class="viewcode-block" id="declare_subsurf_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.declare_subsurf_settings">[docs]</a><span class="k">def</span> <span class="nf">declare_subsurf_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">subsurf_settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare Subdivision Surface (Subsurf) modifiers with specified settings.</span>

<span class="sd">    This function adds Subsurf modifiers to a Blender object based on the provided</span>
<span class="sd">    settings dictionary.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object to which Subsurf</span>
<span class="sd">                                         modifiers will be added.</span>
<span class="sd">    :param dict subsurf_settings: A dictionary storing Subsurf modifier settings</span>
<span class="sd">                                  for each modifier.</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier_name</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">subsurf_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_modifier</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">modifier_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SUBSURF&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;subdivision_type&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">new_modifier</span><span class="o">.</span><span class="n">subdivision_type</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;subdivision_type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">new_modifier</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;quality&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">new_modifier</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="store_cloth_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.store_cloth_settings">[docs]</a><span class="k">def</span> <span class="nf">store_cloth_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store settings of Cloth modifiers applied to a Blender object.</span>

<span class="sd">    This function stores the settings of Cloth modifiers applied to a Blender cell</span>
<span class="sd">    object, including various parameters related to cloth simulation.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object </span>
<span class="sd">                                         containing Cloth modifiers.</span>
<span class="sd">    :returns: A dictionary storing Cloth modifier settings for each modifier.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cloth_settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;CLOTH&#39;</span><span class="p">:</span>
            <span class="n">cloth_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">settings</span>
            <span class="n">cloth_cell_settings</span> <span class="o">=</span> <span class="n">cloth_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            
            <span class="c1"># Using cloth_cell_settings for clarity</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">quality</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;air_damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">air_damping</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;bending_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">bending_model</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">mass</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;time_scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">time_scale</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;tension_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tension_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;compression_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">compression_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;shear_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">shear_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;bending_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">bending_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;tension_damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tension_damping</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;compression_damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">compression_damping</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;shear_damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">shear_damping</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;bending_damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">bending_damping</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_internal_springs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_spring_max_length&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_length</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_spring_max_diversion&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_diversion</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_spring_normal_check&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_normal_check</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_tension_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_compression_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_tension_stiffness_max&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness_max</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;internal_compression_stiffness_max&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness_max</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">use_pressure</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;uniform_pressure_force&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_pressure_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">use_pressure_volume</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;target_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">target_volume</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;pressure_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">pressure_factor</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;fluid_density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">fluid_density</span>

            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">collision_settings</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">collision_settings</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;collision_quality&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">collision_quality</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;use_collision&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">use_collision</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;use_self_collision&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">use_self_collision</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;self_friction&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">self_friction</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;friction&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">friction</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;self_distance_min&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">self_distance_min</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;distance_min&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">distance_min</span>
            <span class="n">cloth_cell_settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">][</span><span class="s1">&#39;self_impulse_clamp&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">collision_settings</span><span class="o">.</span><span class="n">self_impulse_clamp</span>
    
    <span class="k">return</span> <span class="n">cloth_settings</span></div>


<div class="viewcode-block" id="declare_cloth_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.declare_cloth_settings">[docs]</a><span class="k">def</span> <span class="nf">declare_cloth_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cloth_settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare Cloth modifiers with specified settings on a cell object.</span>

<span class="sd">    This function adds Cloth modifiers to a Blender cell object based on the provided</span>
<span class="sd">    settings dictionary.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object to which Cloth</span>
<span class="sd">                                         modifiers will be added.</span>
<span class="sd">    :param dict cloth_settings: A dictionary storing Cloth modifier settings</span>
<span class="sd">                               for each modifier.</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier_name</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">cloth_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_modifier</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">modifier_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CLOTH&#39;</span><span class="p">)</span>
        <span class="n">new_settings</span> <span class="o">=</span> <span class="n">new_modifier</span><span class="o">.</span><span class="n">settings</span>
        <span class="k">for</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">setting_name</span> <span class="o">!=</span> <span class="s1">&#39;collision_settings&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">new_settings</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">collision_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;collision_settings&#39;</span><span class="p">]</span>
                <span class="n">new_collision_settings</span> <span class="o">=</span> <span class="n">new_modifier</span><span class="o">.</span><span class="n">collision_settings</span>
                <span class="k">for</span> <span class="n">coll_sett_name</span><span class="p">,</span> <span class="n">coll_sett_value</span> <span class="ow">in</span> <span class="n">collision_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">new_collision_settings</span><span class="p">,</span> 
                            <span class="n">coll_sett_name</span><span class="p">,</span> 
                            <span class="n">coll_sett_value</span><span class="p">)</span>
                    
    <span class="k">return</span> </div>


<div class="viewcode-block" id="store_collision_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.store_collision_settings">[docs]</a><span class="k">def</span> <span class="nf">store_collision_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store settings of Collision modifiers applied to a cell object.</span>

<span class="sd">    This function stores the settings of Collision modifiers applied to a Blender cell</span>
<span class="sd">    object, including various collision-related parameters.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object </span>
<span class="sd">                                         containing Collision modifiers.</span>
<span class="sd">    :returns: A dictionary storing Collision modifier settings for each modifier.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collision_settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;COLLISION&#39;</span><span class="p">:</span>
            <span class="n">collision_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">settings</span>
            <span class="n">collision_cell_settings</span> <span class="o">=</span> <span class="n">collision_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">collision_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_culling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">use_culling</span>
            <span class="n">collision_cell_settings</span><span class="p">[</span><span class="s1">&#39;damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">damping</span>
            <span class="n">collision_cell_settings</span><span class="p">[</span><span class="s1">&#39;thickness_outer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">thickness_outer</span>
            <span class="n">collision_cell_settings</span><span class="p">[</span><span class="s1">&#39;thickness_inner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">thickness_inner</span>
            <span class="n">collision_cell_settings</span><span class="p">[</span><span class="s1">&#39;cloth_friction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">cloth_friction</span>
            <span class="c1"># ... (other Collision settings)</span>
    <span class="k">return</span> <span class="n">collision_settings</span></div>


<div class="viewcode-block" id="declare_collision_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.declare_collision_settings">[docs]</a><span class="k">def</span> <span class="nf">declare_collision_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collision_settings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare Collision modifiers with specified settings on a cell object.</span>

<span class="sd">    This function adds Collision modifiers to a Blender cell object </span>
<span class="sd">    based on the provided settings dictionary.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object to which Collision</span>
<span class="sd">                                         modifiers will be added.</span>
<span class="sd">    :param dict collision_settings: A dictionary storing Collision modifier settings</span>
<span class="sd">                                    for each modifier.</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier_name</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">collision_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_modifier</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">modifier_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;COLLISION&#39;</span><span class="p">)</span>
        <span class="n">new_settings</span> <span class="o">=</span> <span class="n">new_modifier</span><span class="o">.</span><span class="n">settings</span>
        <span class="k">for</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new_settings</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
    <span class="k">return</span></div>


<div class="viewcode-block" id="store_remesh_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.store_remesh_settings">[docs]</a><span class="k">def</span> <span class="nf">store_remesh_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store settings of Remesh modifiers applied to a cell object.</span>

<span class="sd">    This function stores the settings of Remesh modifiers applied to a Blender cell</span>
<span class="sd">    object, including various remesh-related parameters.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender cell object </span>
<span class="sd">                                         containing Remesh modifiers.</span>
<span class="sd">    :returns: A dictionary storing Remesh modifier settings for each modifier.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">remesh_settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;REMESH&#39;</span><span class="p">:</span>
            <span class="n">remesh_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">remesh_cell_settings</span> <span class="o">=</span> <span class="n">remesh_settings</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">mode</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;voxel_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">voxel_size</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;adaptivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">adaptivity</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_remove_disconnected&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">modifier</span><span class="o">.</span><span class="n">use_remove_disconnected</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;use_smooth_shade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">use_smooth_shade</span>
            <span class="n">remesh_cell_settings</span><span class="p">[</span><span class="s1">&#39;show_in_editmode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">show_in_editmode</span>
    <span class="k">return</span> <span class="n">remesh_settings</span></div>


<div class="viewcode-block" id="declare_remesh_settings"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.declare_remesh_settings">[docs]</a><span class="k">def</span> <span class="nf">declare_remesh_settings</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">remesh_settings</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">modifier_name</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">remesh_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_modifier</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new_modifier</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="divide_boolean"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.divide_boolean">[docs]</a><span class="k">def</span> <span class="nf">divide_boolean</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Divide a cell object along its division plane using boolean operations.</span>

<span class="sd">    This function performs boolean division on a Blender cell object, creating two</span>
<span class="sd">    daughter cells. It also handles the declaration of daughter forces, </span>
<span class="sd">    inheritance of properties, and separation of the mesh.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object to be divided.</span>

<span class="sd">    :return: </span>
<span class="sd">             - bpy.data.objects[&#39;name&#39;]: First daughter cell.</span>
<span class="sd">             - bpy.data.objects[&#39;name&#39;]: Second daughter cell.</span>
<span class="sd">             - float: Adhesion strength.</span>
<span class="sd">             - float: Motion strength.</span>
<span class="sd">             - float: Falloff.</span>
<span class="sd">             - bool: Flag indicating if there was a mother adhesion force.</span>
<span class="sd">             - bool: Flag indicating if there was a mother motion force.</span>
<span class="sd">             - list: List of dictionaries containing values of the modifiers applied \</span>
<span class="sd">                    to the original object before division.   </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize variables</span>
    <span class="n">adhesion_strength</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Default value</span>
    <span class="n">motion_strength</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Default value</span>
    <span class="n">falloff</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Default value</span>
    <span class="n">mother_adhesion</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Default value</span>
    <span class="n">mother_motion</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Default value</span>

    <span class="c1"># Get COM</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="c1"># Get the long axis in global coordinate from the origin</span>
    <span class="n">p2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_long_axis_global</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>    

    <span class="c1"># Get mother modifiers and their values</span>
    <span class="n">mother_modifiers</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span>

    <span class="c1"># Get the values of the modifiers</span>
    <span class="n">modifier_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">mother_modifiers</span><span class="p">:</span>
        <span class="n">modifier_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">modifier</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">modifier</span><span class="p">,</span> <span class="n">attr</span><span class="p">)):</span>
                <span class="n">modifier_data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modifier</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="n">modifier_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier_data</span><span class="p">)</span>

    <span class="c1"># Get the angles representing the orientation of the division plane</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">get_line_angles</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="c1"># Get name of dividing cell</span>
    <span class="n">mother_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
    <span class="c1"># Create division plane</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">primitive_plane_add</span><span class="p">(</span><span class="n">enter_editmode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                             <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                                             <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span> 
                                             <span class="n">location</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> 
                                             <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
                                             <span class="n">rotation</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="c1"># Set plane as active object</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="c1"># Rename plane with specific cell name</span>
    <span class="n">plane_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mother_name</span><span class="si">}</span><span class="s2">_division plane&quot;</span>
    <span class="n">plane</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">plane_name</span>

    <span class="c1"># Add solidify modifier to the plane, add tickness to the plane</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SOLIDIFY&#39;</span><span class="p">)</span>
    <span class="n">solid_mod</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">solid_mod</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">solid_mod</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="mf">0.03</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">solid_mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">Force</span><span class="o">.</span><span class="n">force_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">force</span> <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">Force</span><span class="o">.</span><span class="n">force_list</span> <span class="k">if</span> <span class="n">force</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">]</span>
    <span class="p">]</span>
    
    <span class="c1"># Remove mother adhesion force</span>
    <span class="k">if</span> <span class="s1">&#39;adhesion force&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span> 
        <span class="n">mother_adhesion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">adhesion_force</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">]]</span>
        <span class="n">adhesion_strength</span> <span class="o">=</span> <span class="n">adhesion_force</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">strength</span>
        <span class="n">falloff</span> <span class="o">=</span> <span class="n">adhesion_force</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">falloff_power</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">]],</span> 
                <span class="n">do_unlink</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

    <span class="c1"># Remove mother motion force</span>
    <span class="k">if</span> <span class="s1">&#39;motion force&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span> 
        <span class="n">mother_motion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">motion_force</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;motion force&#39;</span><span class="p">]]</span>
        <span class="n">motion_strength</span> <span class="o">=</span> <span class="n">motion_force</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">strength</span>

        <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;motion force&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;motion force&#39;</span><span class="p">]],</span> 
                <span class="n">do_unlink</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

    <span class="c1"># Add boolean modifier to the original object</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;BOOLEAN&#39;</span><span class="p">)</span>
    <span class="n">bool_mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bool_mod</span><span class="o">.</span><span class="n">operand_type</span> <span class="o">=</span> <span class="s1">&#39;OBJECT&#39;</span>
    <span class="n">bool_mod</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">plane_name</span><span class="p">]</span>
    <span class="n">bool_mod</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="s1">&#39;DIFFERENCE&#39;</span>
    <span class="n">bool_mod</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;EXACT&#39;</span>

    <span class="c1"># bpy.ops.object.modifier_apply(modifier=&quot;Cloth&quot;)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">bool_mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Hide the plane</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">plane_name</span><span class="p">]</span><span class="o">.</span><span class="n">hide_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Deselect all vertices in edit mode</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;EDIT&#39;</span><span class="p">)</span>  
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_mode</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VERT&quot;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">)</span>

    <span class="c1"># Select a vertex in object mode</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span>
    <span class="n">vertex</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vertex</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># select all vertices linked to the selected vertex</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;EDIT&#39;</span><span class="p">)</span> 
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_linked</span><span class="p">(</span><span class="n">delimit</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;NORMAL&#39;</span><span class="p">})</span>
    <span class="c1"># Separate the outer and inner parts of the mesh</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SELECTED&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">)</span>

    <span class="n">d1</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># to be renamed</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mother_name</span><span class="si">}</span><span class="s2">.01&quot;</span>  <span class="c1"># new cell</span>

    <span class="n">d2</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">mother_name</span><span class="p">]</span>
    <span class="n">d2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mother_name</span><span class="si">}</span><span class="s2">.02&quot;</span>  <span class="c1"># mother cell</span>

    <span class="c1"># Declare collections to contain daughter cells</span>
    <span class="n">mother_collection</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mother_type</span> <span class="o">=</span> <span class="n">mother_collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
    <span class="n">d1_collection</span> <span class="o">=</span> <span class="n">make_collection</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_collection&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">mother_type</span><span class="p">)</span>
    <span class="n">d2_collection</span> <span class="o">=</span> <span class="n">make_collection</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_collection&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">mother_type</span><span class="p">)</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">d1</span>
    <span class="c1"># remove duplicate objects outside of the collection</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects_remove_all</span><span class="p">()</span>
    <span class="c1"># Add the active cell to our specific collection </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">d1_collection</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
 
    <span class="c1"># Pass on the mother force</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;MESH&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="c1"># Adding a Remesh modifier to the converted mesh</span>
    <span class="n">remesh_modifier</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Remesh&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span><span class="p">)</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;VOXEL&#39;</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># microns</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">adaptivity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">use_remove_disconnected</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">use_smooth_shade</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="s2">&quot;Remesh&quot;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">d2</span>
    <span class="c1"># remove duplicate objects outside of the collection</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects_remove_all</span><span class="p">()</span>
    <span class="c1"># Add the active cell to our specific collection </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">d2_collection</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>

    <span class="n">d2</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;MESH&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">remesh_modifier</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Remesh&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span><span class="p">)</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;VOXEL&#39;</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># microns</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">adaptivity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">use_remove_disconnected</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">remesh_modifier</span><span class="o">.</span><span class="n">use_smooth_shade</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="s2">&quot;Remesh&quot;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Retrieve the collection by name</span>

    <span class="k">if</span> <span class="n">mother_collection</span><span class="p">:</span>
        <span class="c1"># Remove the collection</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">mother_collection</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection &#39;</span><span class="si">{</span><span class="n">mother_collection</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

    <span class="c1"># Delete the plane if it exists</span>
    <span class="k">if</span> <span class="n">plane_name</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
        <span class="c1"># Get the object reference</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">plane_name</span><span class="p">]</span>
        <span class="c1"># Remove the object</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">do_unlink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Division plane: &#39;</span><span class="si">{</span><span class="n">plane_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">adhesion_strength</span><span class="p">,</span> <span class="n">motion_strength</span><span class="p">,</span> \
        <span class="n">falloff</span><span class="p">,</span> <span class="n">mother_adhesion</span><span class="p">,</span> <span class="n">mother_motion</span><span class="p">,</span> <span class="n">modifier_values</span></div>


<div class="viewcode-block" id="disable_internal_springs"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.disable_internal_springs">[docs]</a><span class="k">def</span> <span class="nf">disable_internal_springs</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disable internal springs for Cloth modifiers in a list of Blender cell objects.</span>

<span class="sd">    This function iterates through the provided list of Blender objects and, for each</span>
<span class="sd">    daughter cell object, checks if a Cloth modifier exists </span>
<span class="sd">    and disables internal springs.</span>

<span class="sd">    :param list objects: A list of Blender cell objects.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Disable internal springs for each object in the list</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Disable internal springs for daughter cells</span>
        <span class="k">for</span> <span class="n">daughter_cell</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">daughter_cell</span><span class="p">:</span>
                <span class="n">modifiers</span> <span class="o">=</span> <span class="n">daughter_cell</span><span class="o">.</span><span class="n">modifiers</span>
                
                <span class="c1"># Check if a Cloth modifier exists and disable internal springs</span>
                <span class="n">cloth_modifier</span> <span class="o">=</span> <span class="n">modifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Cloth&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cloth_modifier</span><span class="p">:</span>
                    <span class="n">cloth_modifier</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_internal_springs</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="apply_physics"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.apply_physics">[docs]</a><span class="k">def</span> <span class="nf">apply_physics</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply cloth physics and related modifiers to a Blender cell object.</span>

<span class="sd">    This function sets up cloth physics and associated modifiers for the </span>
<span class="sd">    provided Blender object. It includes Subdivision Surface (Subsurf), </span>
<span class="sd">    Cloth, Collision, and Remesh modifiers.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object to apply physics to.</span>
<span class="sd">    :param float stiffness: Stiffness value for Cloth modifier.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting modifiers declaration&#39;</span><span class="p">)</span>
    
    <span class="c1"># Select object and make it active</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>    
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Add subsurface modifier to make smoother</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SUBSURF&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Subdivision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">subdivision_type</span> <span class="o">=</span> <span class="s1">&#39;CATMULL_CLARK&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Subdivision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Subdivision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># Add cloth settings </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CLOTH&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">air_damping</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_model</span> <span class="o">=</span> <span class="s1">&#39;ANGULAR&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">time_scale</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Cloth &gt; Stiffness </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">tension_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compression_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">shear_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_stiffness</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Cloth &gt; Damping</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">tension_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compression_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">shear_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_damping</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="c1"># Cloth &gt; Internal Springs</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_internal_springs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_length</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_diversion</span> <span class="o">=</span> \
        <span class="mf">0.785398</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_normal_check</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness_max</span> <span class="o">=</span> \
        <span class="mi">10000</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness_max</span> \
        <span class="o">=</span> <span class="mi">10000</span>
    <span class="c1"># Cloth &gt; Pressure</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_pressure</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;previous pressure&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_pressure_volume</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">target_volume</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">pressure_factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fluid_density</span> <span class="o">=</span> <span class="mf">1.05</span>
    <span class="c1"># Cloth &gt; Collisions</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">collision_quality</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">use_collision</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">use_self_collision</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_friction</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_distance_min</span> <span class="o">=</span> <span class="mf">0.002</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">distance_min</span> <span class="o">=</span> <span class="mf">0.002</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_impulse_clamp</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Collision</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;COLLISION&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_culling</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">thickness_outer</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">thickness_inner</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cloth_friction</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="c1"># Remesh</span>
    <span class="n">remesh_mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;VOXEL&#39;</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># microns</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">adaptivity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># remesh_mod.mode = &#39;SMOOTH&#39;</span>
    <span class="c1"># remesh_mod.octree_depth = 4</span>
    <span class="c1"># remesh_mod.scale = 0.75</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_remove_disconnected</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_smooth_shade</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">remesh_mod</span><span class="o">.</span><span class="n">show_in_editmode</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># bpy.ops.object.modifier_move_to_index(modifier=f&quot;Remesh1_{obj.name}&quot;, index=3)</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Enable the cache of the daughter cloth simulations to match </span>
    <span class="c1"># the simulation start and end frames</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">point_cache</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">point_cache</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span></div>


<div class="viewcode-block" id="cast_to_sphere"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.cast_to_sphere">[docs]</a><span class="k">def</span> <span class="nf">cast_to_sphere</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a Cast modifier to round up a cell object.</span>

<span class="sd">    This function applies a Cast modifier to the provided Blender cell object, </span>
<span class="sd">    creating a rounded shape.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object to be rounded.</span>
<span class="sd">    :param float factor: The factor to adjust the level of rounding. Default is 0.5.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Select the object to round up</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object named &#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="c1"># Apply a &quot;Cast&quot; modifier to the duplicated object</span>
    <span class="n">cast_modifier</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cast&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CAST&#39;</span><span class="p">)</span>
    <span class="n">cast_modifier</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>  <span class="c1"># Adjust the factor for the level of rounding</span></div>
    
    <span class="c1"># Apply the modifier to generate the rounded shape</span>
    <span class="c1"># bpy.ops.object.modifier_apply(modifier=&quot;Cast&quot;)</span>


<div class="viewcode-block" id="to_sphere"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.to_sphere">[docs]</a><span class="k">def</span> <span class="nf">to_sphere</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forces a Blender cell object into a sphere shape.</span>

<span class="sd">    This function updates the object&#39;s origin, simplifies its topology, and returns</span>
<span class="sd">    the modified object.</span>

<span class="sd">    :param bpy.data.objects[&#39;name&#39;] obj: The Blender object to be transformed \</span>
<span class="sd">        into a sphere.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

    <span class="c1"># Update the object and the shape key</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">origin_set</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ORIGIN_CENTER_OF_MASS&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;MEDIAN&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

    <span class="c1"># simplify topology </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;EDIT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_mode</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VERT&quot;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;SELECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">decimate</span><span class="p">(</span><span class="n">ratio</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">reveal</span><span class="p">()</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="make_collection"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.make_collection">[docs]</a><span class="k">def</span> <span class="nf">make_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and link a new Blender collection to the scene.</span>

<span class="sd">    This function creates a new collection with the given cell name and cell type,</span>
<span class="sd">    and links it to the current scene. Collections act as placeholder for cell types.</span>

<span class="sd">    :param str name: The name of the new collection.</span>
<span class="sd">    :param str type: The type of the new collection.</span>

<span class="sd">    :return: The newly created collection.</span>
<span class="sd">    :rtype: bpy.types.Collection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a new collection</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># Cell type</span>
    <span class="n">collection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="c1"># Blender object type</span>
    <span class="n">collection</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;collection&#39;</span>
    <span class="c1"># link the collection to the scene for visualization </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">collection</span></div>


<div class="viewcode-block" id="make_cell"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.make_cell">[docs]</a><span class="k">def</span> <span class="nf">make_cell</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">loc</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">remeshing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">stiffness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">material</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bubble&quot;</span><span class="p">,</span> <span class="mf">0.007</span><span class="p">,</span> <span class="mf">0.021</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> 
    <span class="n">arcdiv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">subdiv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
    <span class="n">mesh</span><span class="o">=</span><span class="s1">&#39;icosphere&#39;</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a Blender cell object.</span>

<span class="sd">    This function creates a new Blender cell object with various settings,</span>
<span class="sd">    such as mesh type, scale, material, and modifiers.</span>

<span class="sd">    :param str name: The name of the new cell object.</span>
<span class="sd">    :param tuple loc: The location of the cell object.</span>
<span class="sd">    :param str type: The type of the new cell object.</span>
<span class="sd">    :param float radius: The radius of the cell object.</span>
<span class="sd">    :param bool remeshing: Whether to apply remeshing modifiers.</span>
<span class="sd">    :param tuple scale: The scale of the cell object.</span>
<span class="sd">    :param float stiffness: The stiffness of the cloth modifier.</span>
<span class="sd">    :param tuple material: The material properties for the cell.</span>
<span class="sd">    :param int arcdiv: The arc divisions for the primitive_round_cube_add function.</span>
<span class="sd">    :param int subdiv: The subdivision levels for the Subsurf modifier.</span>
<span class="sd">    :param str mesh: The type of mesh to create (&#39;roundcube&#39; or &#39;icosphere&#39;).</span>

<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="n">make_collection</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_collection&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mesh</span> <span class="o">==</span> <span class="s1">&#39;roundcube&#39;</span><span class="p">:</span> 
        <span class="c1"># Create mesh</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">primitive_round_cube_add</span><span class="p">(</span><span class="n">change</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                              <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                              <span class="n">size</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                              <span class="n">arc_div</span><span class="o">=</span><span class="n">arcdiv</span><span class="p">,</span>
                                              <span class="n">lin_div</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="n">div_type</span><span class="o">=</span><span class="s1">&#39;CORNERS&#39;</span><span class="p">,</span>
                                              <span class="n">odd_axis_align</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                              <span class="n">no_limit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                              <span class="n">location</span><span class="o">=</span><span class="n">loc</span>
                                              <span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">mesh</span> <span class="o">==</span> <span class="s1">&#39;icosphere&#39;</span><span class="p">:</span> 
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">primitive_ico_sphere_add</span><span class="p">(</span><span class="n">subdivisions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                              <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                              <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span>
                                              <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                                              <span class="n">scale</span><span class="o">=</span><span class="n">scale</span>
                                              <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mesh type. Goo currently supports </span><span class="se">\</span>
<span class="s2">                         &#39;roundcube&#39; and &#39;icosphere&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Give the Blender object the cell&#39;s name</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;past position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;current position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 

    <span class="c1"># Smooth the mesh</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">shade_smooth</span><span class="p">()</span>

    <span class="c1"># Add subsurface modifier to make smoother</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SUBSURF&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Subdivision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">subdiv</span>

    <span class="c1"># Add cloth settings </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CLOTH&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">air_damping</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_model</span> <span class="o">=</span> <span class="s1">&#39;ANGULAR&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">time_scale</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Cloth &gt; Stiffness </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">tension_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compression_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">shear_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_stiffness</span> <span class="o">=</span> <span class="n">stiffness</span>
    <span class="c1"># Cloth &gt; Damping</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">tension_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compression_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">shear_damping</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bending_damping</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="c1"># Cloth &gt; Internal Springs</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_internal_springs</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_length</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_max_diversion</span> \
        <span class="o">=</span> <span class="mf">0.785398</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_spring_normal_check</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness</span> \
        <span class="o">=</span> <span class="mi">10</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_tension_stiffness_max</span> \
        <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">internal_compression_stiffness_max</span> \
        <span class="o">=</span> <span class="mi">10000</span>
    <span class="c1"># Cloth &gt; Pressure</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_pressure</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;previous pressure&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_pressure_volume</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">target_volume</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">pressure_factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fluid_density</span> <span class="o">=</span> <span class="mf">1.05</span>
    <span class="c1"># Cloth &gt; Collisions</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">collision_quality</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">use_collision</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">use_self_collision</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_friction</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_distance_min</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">distance_min</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Cloth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collision_settings</span><span class="o">.</span><span class="n">self_impulse_clamp</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Collision</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;COLLISION&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_culling</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">thickness_outer</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">thickness_inner</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s1">&#39;Collision&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cloth_friction</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="k">if</span> <span class="n">remeshing</span><span class="p">:</span> 

        <span class="n">remesh_mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Remesh_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;VOXEL&#39;</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># microns</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">adaptivity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_remove_disconnected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_smooth_shade</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">show_in_editmode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_move_to_index</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh1_</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># add material, default is purple bubble</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">add_material</span><span class="p">(</span><span class="n">material</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                       <span class="nb">float</span><span class="p">(</span><span class="n">material</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
                       <span class="nb">float</span><span class="p">(</span><span class="n">material</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> 
                       <span class="nb">float</span><span class="p">(</span><span class="n">material</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                       <span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>

    <span class="c1"># remove duplicate objects outside of the collection</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects_remove_all</span><span class="p">()</span>
    <span class="c1"># Add the active cell to our specific collection </span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="add_material"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_material">[docs]</a><span class="k">def</span> <span class="nf">add_material</span><span class="p">(</span><span class="n">mat_name</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a soap bubble-like Blender material for use in rendering </span>
<span class="sd">    cells.</span>

<span class="sd">    The material has a name that allows it to be shared across multiple cells. </span>

<span class="sd">    :param str mat_name: The name of the material. </span>
<span class="sd">    :param float r: The value of the red in RGB [0 to 1]. </span>
<span class="sd">    :param float g: The value of the green value in RGB [0 to 1]. </span>
<span class="sd">    :param float b: The value of the blue value in RGB [0 to 1]. </span>

<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mat_name</span><span class="p">):</span> 
        <span class="n">mat</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">diffuse_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># viewport color</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">use_nodes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">blend_method</span> <span class="o">=</span> <span class="s1">&#39;BLEND&#39;</span>

        <span class="c1"># get the material nodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>

        <span class="c1"># clear all nodes to start clean</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># create principled node for main color</span>
        <span class="n">node_main</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeBsdfPrincipled&#39;</span><span class="p">)</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Base Color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Metallic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.136</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.555</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.318</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.041</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic Rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.048</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.052</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.030</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.114</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.123</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;IOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.450</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.882</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.414</span>

        <span class="c1"># create noise texture source</span>
        <span class="n">node_noise</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShaderNodeTexNoise&quot;</span><span class="p">)</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.600</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Detail&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">15.0</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Distortion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">3.0</span>

        <span class="c1"># create HSV</span>
        <span class="n">node_HSV</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShaderNodeHueSaturation&quot;</span><span class="p">)</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Hue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.800</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Saturation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">2.00</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">2.00</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Fac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.00</span>

        <span class="c1"># create second principled node for random color variation</span>
        <span class="n">node_random</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeBsdfPrincipled&#39;</span><span class="p">)</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Base Color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Metallic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.482</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic Rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;IOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.450</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.555</span>

        <span class="c1"># create mix shader node</span>
        <span class="n">node_mix</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeMixShader&#39;</span><span class="p">)</span>
        <span class="n">node_mix</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Fac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.079</span>

        <span class="c1"># create output node</span>
        <span class="n">node_output</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeOutputMaterial&#39;</span><span class="p">)</span>
        <span class="n">node_output</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span>

        <span class="c1"># link nodes</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_noise</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># link_noise_HSV</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_HSV</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># link_HSV_random</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_main</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># link_main_mix</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_random</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># link_random_mix</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_mix</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_output</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># link_mix_out</span>

    <span class="k">else</span><span class="p">:</span> 
        <span class="n">mat</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">mat_name</span><span class="p">)</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">diffuse_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># viewport color</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">use_nodes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">blend_method</span> <span class="o">=</span> <span class="s1">&#39;BLEND&#39;</span>

        <span class="c1"># get the material nodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>

        <span class="c1"># clear all nodes to start clean</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># create principled node for main color</span>
        <span class="n">node_main</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeBsdfPrincipled&#39;</span><span class="p">)</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Base Color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Metallic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.136</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.555</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.318</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.041</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic Rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.048</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.052</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.030</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.114</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.123</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;IOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.450</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.882</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_main</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.414</span>

        <span class="c1"># create noise texture source</span>
        <span class="n">node_noise</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShaderNodeTexNoise&quot;</span><span class="p">)</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.600</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Detail&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">15.0</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_noise</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Distortion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">3.0</span>

        <span class="c1"># create HSV</span>
        <span class="n">node_HSV</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShaderNodeHueSaturation&quot;</span><span class="p">)</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Hue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.800</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Saturation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">2.00</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">2.00</span>
        <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Fac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.00</span>

        <span class="c1"># create second principled node for random color variation</span>
        <span class="n">node_random</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeBsdfPrincipled&#39;</span><span class="p">)</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Base Color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Metallic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.500</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Specular Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.482</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Anisotropic Rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Sheen Tint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Clearcoat Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;IOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.450</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Transmission Roughness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.555</span>

        <span class="c1"># create mix shader node</span>
        <span class="n">node_mix</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeMixShader&#39;</span><span class="p">)</span>
        <span class="n">node_mix</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Fac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.079</span>

        <span class="c1"># create output node</span>
        <span class="n">node_output</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeOutputMaterial&#39;</span><span class="p">)</span>
        <span class="n">node_output</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span>

        <span class="c1"># link nodes</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_noise</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_HSV</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># link_noise_HSV</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_HSV</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_random</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># link_HSV_random</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_main</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># link_main_mix</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_random</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_mix</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># link_random_mix</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_mix</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_output</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># link_mix_out</span>

    <span class="k">return</span> <span class="n">mat</span></div>


<div class="viewcode-block" id="Force"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.Force">[docs]</a><span class="k">class</span> <span class="nc">Force</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates Force (Python) objects. </span>

<span class="sd">    The class instantiates :class:`Force` objects that represent </span>
<span class="sd">    adhesion forces between cells in Blender. </span>
<span class="sd">    </span>
<span class="sd">    :param str force_name: The name of the force.</span>
<span class="sd">    :param str cell_name: The name of the cell. </span>
<span class="sd">    :param float strength: The strength of the force.</span>
<span class="sd">    :param float falloff_power: The power of the falloff of the force. </span>
<span class="sd">    :returns: None</span>

<span class="sd">    .. note:: ``falloff_power`` is a positive (:py:class:`float`). </span>
<span class="sd">        By default, the type of the falloff is set to `SPHERE` </span>
<span class="sd">        and its shape is set to `SURFACE`. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">force_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">force_name</span><span class="p">,</span> 
                 <span class="n">cell_name</span><span class="p">,</span> 
                 <span class="n">strength</span><span class="p">,</span> 
                 <span class="n">falloff_power</span><span class="p">,</span> 
                 <span class="n">collection_name</span><span class="p">,</span> 
                 <span class="nb">type</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">force_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strength</span> <span class="o">=</span> <span class="n">strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associated_cell</span> <span class="o">=</span> <span class="n">cell_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falloff_power</span> <span class="o">=</span> <span class="n">falloff_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falloff_type</span> <span class="o">=</span> <span class="s1">&#39;SPHERE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;SURFACE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>  <span class="c1"># boolean</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="n">Force</span><span class="o">.</span><span class="n">force_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># list of all the created forces</span>

<div class="viewcode-block" id="Force.get_strength"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.Force.get_strength">[docs]</a>    <span class="k">def</span> <span class="nf">get_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the strength attribute of Force.</span>

<span class="sd">        :return: The strength of a Blender force.</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength</span></div>
    
<div class="viewcode-block" id="Force.get_falloff"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.Force.get_falloff">[docs]</a>    <span class="k">def</span> <span class="nf">get_falloff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the falloff attribute of Force.</span>

<span class="sd">        :return: The falloff of a Blender force.</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">falloff_power</span></div>

<div class="viewcode-block" id="Force.get_blender_force"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.Force.get_blender_force">[docs]</a>    <span class="k">def</span> <span class="nf">get_blender_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Blender object of Force.</span>

<span class="sd">        :return: The Blender force obj.</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">obj</span></div></div>


<div class="viewcode-block" id="add_boundaries"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_boundaries">[docs]</a><span class="k">def</span> <span class="nf">add_boundaries</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;BOX&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REFLECTIVE&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds reflective boundaries to the scene.</span>

<span class="sd">    The boundaries can be of the shape of sphere or boxes. </span>

<span class="sd">    :param tuple loc: A tuple containing X, Y, and Z coordinates of the center of \</span>
<span class="sd">        the boundary.</span>
<span class="sd">    :param tuple size: A tuple containing dimensions in X, Y, and Z \</span>
<span class="sd">        for the boundary.</span>
<span class="sd">    :param str shape: The shape of the boundary. Supported values are \</span>
<span class="sd">        &#39;BOX&#39; and &#39;SPHERE&#39;.</span>
<span class="sd">    :param str type: The type of boundary. (Unused parameter in the provided code)</span>
<span class="sd">    :param str name: The name to be assigned to the boundary object.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;loc&#39; argument. It should be a tuple containing X, Y, and Z </span><span class="se">\</span>
<span class="s2">                coordinates.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;loc&#39; coordinates. Coordinates should be integers or floats.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;size&#39; argument. It should be a tuple containing dimensions in X, </span><span class="se">\</span>
<span class="s2">                Y, and Z.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;size&#39; dimensions. Dimensions should be integers or floats.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">shape</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BOX&#39;</span><span class="p">,</span> <span class="s1">&#39;SPHERE&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;shape&#39; argument. Supported shapes are &#39;BOX&#39; and &#39;SPHERE&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;BOX&#39;</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">primitive_cube_add</span><span class="p">(</span><span class="n">enter_editmode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span>
                                        <span class="n">location</span><span class="o">=</span><span class="n">loc</span>
                                        <span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;COLLISION&#39;</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;WIREFRAME&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;SPHERE&#39;</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">primitive_uv_sphere_add</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">enter_editmode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span>
                                             <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;COLLISION&#39;</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;WIREFRAME&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="add_motion"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_motion">[docs]</a><span class="k">def</span> <span class="nf">add_motion</span><span class="p">(</span><span class="n">effector_name</span><span class="p">,</span>
               <span class="n">strength</span><span class="p">,</span>
               <span class="n">persistence</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">randomness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds motion force to a cell.</span>

<span class="sd">    This function creates a motion force effector based on the specified parameters and </span>
<span class="sd">    links it to the corresponding cell.</span>

<span class="sd">    :param str effector_name: The name of the cell object to which the motion \</span>
<span class="sd">        force will be applied.</span>
<span class="sd">    :param float strength: The strength of the motion force.</span>
<span class="sd">    :param float persistence: The persistence of the motion force (default is 0).</span>
<span class="sd">    :param float randomness: The randomness of the motion force.</span>
<span class="sd">    :param str distribution: The distribution type of the motion force \</span>
<span class="sd">        (default is &#39;uniform&#39;).</span>
<span class="sd">    :param float size: The size of the distribution for the motion force.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">effector_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">persistence</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">randomness</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>

        <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">effector_name</span><span class="p">]</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">make_force</span><span class="p">(</span><span class="n">force_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;motion_</span><span class="si">{</span><span class="n">effector_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">cell_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">effector_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="nb">type</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span>
                           <span class="n">strength</span><span class="o">=</span><span class="n">strength</span><span class="p">,</span>
                           <span class="n">falloff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">motion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">min_dist</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">max_dist</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

        <span class="n">force</span><span class="p">[</span><span class="s1">&#39;persistence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persistence</span>
        <span class="n">force</span><span class="p">[</span><span class="s1">&#39;randomness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomness</span>
        <span class="n">force</span><span class="p">[</span><span class="s1">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span>
        <span class="n">force</span><span class="p">[</span><span class="s1">&#39;distribution size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>

    <span class="k">else</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Types not supported&#39;</span><span class="p">)</span>
    
    <span class="k">return</span></div>


<div class="viewcode-block" id="add_hetero_adhesion"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_hetero_adhesion">[docs]</a><span class="k">def</span> <span class="nf">add_hetero_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">other_type_name</span><span class="p">,</span> <span class="n">strength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds heterotypic adhesion force between a cell and cells of another type.</span>

<span class="sd">    This function creates a heterotypic adhesion force between a cell and cells </span>
<span class="sd">    of another specified type. The adhesion force is applied to the cell based </span>
<span class="sd">    on the specified strength.</span>

<span class="sd">    :param str cell_name: The name of the cell to which the heterotypic adhesion force \</span>
<span class="sd">          will be applied.</span>
<span class="sd">    :param str other_type_name: The name of the other cell type to which the adhesion \</span>
<span class="sd">        force will be applied.</span>
<span class="sd">    :param float strength: The strength of the heterotypic adhesion force.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hetero_collections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">coll</span> <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span> <span class="k">if</span> <span class="n">coll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other_type_name</span>
    <span class="p">]</span>

    <span class="n">force</span> <span class="o">=</span> <span class="n">make_force</span><span class="p">(</span><span class="n">force_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;heterotypic_</span><span class="si">{</span><span class="n">cell_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">other_type_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="n">cell_name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span>
                       <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
                       <span class="n">strength</span><span class="o">=</span><span class="n">strength</span><span class="p">,</span>
                       <span class="n">falloff</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">motion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">hetero_collections</span><span class="p">:</span>
        <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="add_homo_adhesion"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_homo_adhesion">[docs]</a><span class="k">def</span> <span class="nf">add_homo_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">strength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds homotypic adhesion force within a cell type.</span>

<span class="sd">    This function creates a homotypic adhesion force within a cell type. </span>
<span class="sd">    The adhesion force is applied to the specified cell based on the specified </span>
<span class="sd">    strength, and it affects other cells of the same type.</span>

<span class="sd">    :param str cell_name: The name of the cell to which the homotypic adhesion force \</span>
<span class="sd">        will be applied.</span>
<span class="sd">    :param float strength: The strength of the homotypic adhesion force.</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">homo_collections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">coll</span> <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span>
        <span class="k">if</span> <span class="n">coll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> 
        <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Homotypic collections: </span><span class="si">{</span><span class="n">homo_collections</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">force</span> <span class="o">=</span> <span class="n">make_force</span><span class="p">(</span><span class="n">force_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;homotypic_</span><span class="si">{</span><span class="n">cell_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="n">cell_name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span>
                       <span class="nb">type</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span>
                       <span class="n">strength</span><span class="o">=</span><span class="n">strength</span><span class="p">,</span>
                       <span class="n">falloff</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">motion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">homo_collections</span><span class="p">:</span>
        <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="make_force"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.make_force">[docs]</a><span class="k">def</span> <span class="nf">make_force</span><span class="p">(</span><span class="n">force_name</span><span class="p">,</span>
               <span class="n">cell_name</span><span class="p">,</span>
               <span class="nb">type</span><span class="p">,</span>
               <span class="n">strength</span><span class="p">,</span>
               <span class="n">falloff</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
               <span class="n">motion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">min_dist</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">max_dist</span><span class="o">=</span><span class="mf">1.2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a Blender force from a Goo :class:`Force` object.</span>

<span class="sd">    This function creates a Blender force object based on the provided parameters. </span>
<span class="sd">    It adds the force to the associated Blender collection and sets various force </span>
<span class="sd">    parameters such as strength, falloff, and motion.</span>

<span class="sd">    :param str force_name: The name of the force object.</span>
<span class="sd">    :param str cell_name: The name of the associated cell object.</span>
<span class="sd">    :param str type: The type of the cell.</span>
<span class="sd">    :param float strength: The strength of the force.</span>
<span class="sd">    :param float falloff: The falloff power of the force (default is 0.5).</span>
<span class="sd">    :param bool motion: A flag indicating whether the force is a motion force \</span>
<span class="sd">        (default is False).</span>
<span class="sd">    :param float min_dist: The minimum distance for the force (default is 0).</span>
<span class="sd">    :param float max_dist: The maximum distance for the force (default is 1.2).</span>

<span class="sd">    :return: The created Goo :class:`Force` object.</span>
<span class="sd">    :rtype: Force</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">force</span> <span class="o">=</span> <span class="n">Force</span><span class="p">(</span><span class="n">force_name</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">,</span> <span class="n">strength</span><span class="p">,</span> <span class="n">falloff</span><span class="p">,</span> <span class="n">collection</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">motion</span><span class="p">)</span>

    <span class="c1"># Add a force object</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">associated_cell</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">motion</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">effector_add</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span>
            <span class="n">enter_editmode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">get_centerofmass</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell</span><span class="p">]),</span>
            <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">force_name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">force_name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)[</span><span class="s2">&quot;adhesion force&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_name</span>

    <span class="k">elif</span> <span class="n">motion</span><span class="p">:</span>

        <span class="n">rand_coord</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,)))</span>
        <span class="n">cell_com</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell</span><span class="p">])</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">effector_add</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span>
                                    <span class="n">enter_editmode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">align</span><span class="o">=</span><span class="s1">&#39;WORLD&#39;</span><span class="p">,</span>
                                    <span class="n">location</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_com</span><span class="p">,</span> <span class="n">rand_coord</span><span class="p">))),</span>
                                    <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">force_name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)[</span><span class="s2">&quot;motion force&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_name</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force_name</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Unsupported forces ----&#39;</span><span class="p">)</span>

    <span class="c1"># Add force parameters</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">strength</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">strength</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">use_max_distance</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">use_min_distance</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">distance_max</span> <span class="o">=</span> <span class="n">max_dist</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">distance_min</span> <span class="o">=</span> <span class="n">min_dist</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">name</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">falloff_power</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">falloff_power</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_name</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;force&#39;</span>

    <span class="n">scene_collection</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span>
    <span class="n">scene_collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">force</span></div>


<div class="viewcode-block" id="setup_world"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.setup_world">[docs]</a><span class="k">def</span> <span class="nf">setup_world</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up the default values used for simulations in Goo </span>
<span class="sd">    including units and rendering background. </span>

<span class="sd">    :param seed: Seed value for random number generation (optional)</span>
<span class="sd">    :type seed: int or None</span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Add required add-ons</span>
    <span class="n">addon_name</span> <span class="o">=</span> <span class="s2">&quot;add_mesh_extra_objects&quot;</span>
    <span class="c1"># Check if the addon is not already enabled</span>
    <span class="k">if</span> <span class="n">addon_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">addons</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">addon_enable</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">addon_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Addon &#39;</span><span class="si">{</span><span class="n">addon_name</span><span class="si">}</span><span class="s2">&#39; has been enabled.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Addon &#39;</span><span class="si">{</span><span class="n">addon_name</span><span class="si">}</span><span class="s2">&#39; is already enabled.&quot;</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="c1"># Turn off gravity so cells don&#39;t fall in the simulation</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">use_gravity</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Set units to the metric system</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;METRIC&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">scale_length</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">system_rotation</span> <span class="o">=</span> <span class="s1">&#39;DEGREES&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">length_unit</span> <span class="o">=</span> <span class="s1">&#39;MICROMETERS&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">mass_unit</span> <span class="o">=</span> <span class="s1">&#39;MILLIGRAMS&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s1">&#39;SECONDS&#39;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">unit_settings</span><span class="o">.</span><span class="n">temperature_unit</span> <span class="o">=</span> <span class="s1">&#39;CELSIUS&#39;</span>
    
    <span class="c1"># Delete all existing objects in the scene except cameras and lights</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CAMERA&#39;</span><span class="p">,</span> <span class="s1">&#39;LIGHT&#39;</span><span class="p">]:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># Delete all existing collections </span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
        <span class="c1"># Delete collection</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>

    <span class="c1"># Add an HDRI image for illumination</span>
    <span class="n">add_world_HDRI</span><span class="p">()</span>

    <span class="c1"># Change the Viewport Shading to Rendered</span>
    <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">screens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;VIEW_3D&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">spaces</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">space</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;VIEW_3D&#39;</span><span class="p">:</span>
                    <span class="n">space</span><span class="o">.</span><span class="n">shading</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;WIREFRAME&#39;</span>
                    <span class="n">space</span><span class="o">.</span><span class="n">overlay</span><span class="o">.</span><span class="n">show_overlays</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="add_world_HDRI"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.add_world_HDRI">[docs]</a><span class="k">def</span> <span class="nf">add_world_HDRI</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up Blender World properties for use in rendering.</span>

<span class="sd">    It adds an HDRI image for illumination. </span>

<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="n">scn</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">scene</span>

    <span class="c1"># Get the environment node tree of the current scene</span>
    <span class="n">node_tree</span> <span class="o">=</span> <span class="n">scn</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">node_tree</span>
    <span class="n">tree_nodes</span> <span class="o">=</span> <span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>
    <span class="c1"># Clear all nodes</span>
    <span class="n">tree_nodes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="c1"># Add Background node</span>
    <span class="n">node_background</span> <span class="o">=</span> <span class="n">tree_nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeBackground&#39;</span><span class="p">)</span>
    <span class="c1"># Add Environment Texture node</span>
    <span class="n">node_environment</span> <span class="o">=</span> <span class="n">tree_nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;ShaderNodeTexEnvironment&#39;</span><span class="p">)</span>
    <span class="c1"># Load and assign the image to the node property</span>
    <span class="n">scripts_paths</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">script_paths</span><span class="p">()</span>

    <span class="c1"># Relative path- this file must be in same directory as blend file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">node_environment</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">scripts_paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;/modules/goo/missile_launch_facility_01_4k.hdr&quot;</span><span class="p">)</span>
    <span class="c1"># If the user does not have this file in the right place, throw exception</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING FROM GOO: To enable proper rendering you must have&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;/modules/goo/missile_launch_facility_01_4k.hdr&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;in the right location&quot;</span><span class="p">)</span>

    <span class="n">node_environment</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">0</span>

    <span class="c1"># Add Output node</span>
    <span class="n">node_output</span> <span class="o">=</span> <span class="n">tree_nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeOutputWorld&#39;</span><span class="p">)</span>
    <span class="n">node_output</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span>
    <span class="c1"># Link all nodes</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>
    <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_environment</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Color&quot;</span><span class="p">],</span> <span class="n">node_background</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Color&quot;</span><span class="p">])</span>
    <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node_background</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">],</span> <span class="n">node_output</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Surface&quot;</span><span class="p">])</span>
    <span class="c1"># set film to transparent to hide background</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">film_transparent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># change render preview mode</span>
    <span class="c1"># only updates windows in current tab, e.g. Sxripting but not Layout</span>
    <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;VIEW_3D&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Update #D Viewport to &#39;RENDERED&#39;&quot;</span><span class="p">)</span>
            <span class="n">space</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">active</span>
            <span class="k">if</span> <span class="n">space</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;VIEW_3D&#39;</span><span class="p">:</span>
                <span class="n">space</span><span class="o">.</span><span class="n">shading</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;WIREFRAME&#39;</span></div>


<div class="viewcode-block" id="render"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.render">[docs]</a><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders a simulation to create a set of still images that </span>
<span class="sd">    can be made into a movie</span>

<span class="sd">    :param str file_path: The path of the folder used to store output images. </span>
<span class="sd">    :param bpy.context.scene scene: The Blender current scene. </span>
<span class="sd">    :param int start: The Blender starting frame. </span>
<span class="sd">    :param int end: The Blender ending frame. </span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span>
    <span class="c1"># Set the image file format as PNG</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">file_format</span> <span class="o">=</span> <span class="s1">&#39;PNG&#39;</span>
    <span class="c1"># Set the file path where the images will be saved</span>
    <span class="n">old_fp</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="c1"># Set the starting and ending frames for the simulation</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="n">end</span>
    <span class="c1"># Set the handlers for the simulation</span>
    <span class="n">handlers</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="c1"># Loop through each frame</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span><span class="p">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span><span class="p">):</span>
        <span class="c1"># Set the frame</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_set</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="c1"># Run each handler</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
        <span class="c1"># Save the image</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;frame&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">+=</span> <span class="n">file_name</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">write_still</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">old_fp</span>
    <span class="c1"># Add each handler to the scene</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="calculate_com"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.calculate_com">[docs]</a><span class="k">def</span> <span class="nf">calculate_com</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the center of mass of a Blender cell object. </span>

<span class="sd">    :param bpy.data.objects[cell.name] cell: cell</span>
<span class="sd">    :return: The coordinate of the center of mass of the cell. </span>
<span class="sd">    :rtype: tuple(x,y,z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">cell</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
    <span class="n">cell_eval</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">cell_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">vert_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">cell_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">])</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">vert_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">vert_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">vert_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">COM</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">COM</span></div>


<div class="viewcode-block" id="get_contact_area"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_contact_area">[docs]</a><span class="k">def</span> <span class="nf">get_contact_area</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the contact ratio between cells in the scene.</span>

<span class="sd">    This function computes the contact ratio between cell objects in the Blender scene. </span>
<span class="sd">    Loops over all cells.</span>
<span class="sd">    It considers the contact area between each pair of cells and calculates the ratio </span>
<span class="sd">    of the contact area to the total surface area of each cell.</span>

<span class="sd">    :param float threshold: The distance threshold to consider vertices in contact \</span>
<span class="sd">        (default is 0.05).</span>

<span class="sd">    :return: A dictionary containing cell pairs as keys and their corresponding \</span>
<span class="sd">        contact ratios and contact areas as values. The contact ratio represents \</span>
<span class="sd">            the ratio of the contact area to the total surface area of each cell. \</span>
<span class="sd">                The contact area represents the total area of contact between the cells.</span>
<span class="sd">    :rtype: dict, dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">contact_ratio_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">contact_areas_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get all cell objects in the scene</span>
    <span class="n">cell_objects</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span> 
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Loop over cell pairs to compute contact ratio</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell_objects</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">mesh1</span> <span class="o">=</span> <span class="n">cell_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_objects</span><span class="p">)):</span>
            <span class="n">mesh2</span> <span class="o">=</span> <span class="n">cell_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">com_mesh1</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">mesh1</span><span class="p">)</span>
            <span class="n">com_mesh2</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="n">com_mesh1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Vector</span><span class="p">(</span><span class="n">com_mesh2</span><span class="p">))</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> 

                <span class="c1"># Evaluate the meshes to account for deformations.</span>
                <span class="n">mesh1_eval</span> <span class="o">=</span> <span class="n">mesh1</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">())</span>
                <span class="n">mesh2_eval</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">())</span>

                <span class="c1"># Get the vertices of the meshes as global coordinates.</span>
                <span class="n">verts1</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span> 
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
                <span class="p">]</span>
                <span class="n">verts2</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span> 
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
                <span class="p">]</span>

                <span class="c1"># Calculate the total surface area of each mesh.</span>
                <span class="n">area1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">)</span>
                <span class="n">area2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">)</span>

                <span class="c1"># Find the vertices in contact for each mesh.</span>
                <span class="n">contact_verts1</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">contact_verts2</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Compute the contact area for each mesh.</span>
                <span class="n">contact_area1</span> <span class="o">=</span> <span class="mf">0.00</span>
                <span class="n">contact_area2</span> <span class="o">=</span> <span class="mf">0.00</span>

                <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">verts1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">verts2</span><span class="p">:</span>
                        <span class="c1"># Check if the distance between the vertices is below the </span>
                        <span class="c1"># threshold.</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                            <span class="n">contact_verts1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                            <span class="n">contact_verts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
                    <span class="n">poly_verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">mesh1_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> 
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">vertices</span>
                    <span class="p">]</span>

                    <span class="c1"># Check if any of the polygon vertices are in contact.</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">v1</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">poly_verts</span> 
                           <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">contact_verts2</span><span class="p">):</span>
                        <span class="n">contact_area1</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">area</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
                    <span class="n">poly_verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">mesh2_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> 
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">vertices</span>
                    <span class="p">]</span>

                    <span class="c1"># Check if any of the polygon vertices are in contact.</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">poly_verts</span> 
                           <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">contact_verts1</span><span class="p">):</span>
                        <span class="n">contact_area2</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">area</span>

                <span class="c1"># Compute the contact area ratio for each mesh.</span>
                <span class="n">ratio1</span> <span class="o">=</span> <span class="n">contact_area1</span> <span class="o">/</span> <span class="n">area1</span> <span class="k">if</span> <span class="n">area1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
                <span class="n">ratio2</span> <span class="o">=</span> <span class="n">contact_area2</span> <span class="o">/</span> <span class="n">area2</span> <span class="k">if</span> <span class="n">area2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

                <span class="c1"># avg ratio because bidirectional contact areas</span>
                <span class="n">bidir_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio1</span> <span class="o">+</span> <span class="n">ratio2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">bidir_areas</span> <span class="o">=</span> <span class="p">(</span><span class="n">contact_area1</span> <span class="o">+</span> <span class="n">contact_area2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># Add contact ratio to the dictionary</span>
                <span class="n">contact_ratio_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mesh1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mesh2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidir_ratio</span>
                <span class="n">contact_areas_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mesh1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mesh2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bidir_areas</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="n">contact_ratio_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mesh1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mesh2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">contact_areas_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mesh1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mesh2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">contact_ratio_dict</span><span class="p">,</span> <span class="n">contact_areas_dict</span></div>


<div class="viewcode-block" id="constrict"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.constrict">[docs]</a><span class="k">def</span> <span class="nf">constrict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constricts selected vertices along a line defined \</span>
<span class="sd">        by the center of mass and the long axis of the object.</span>

<span class="sd">    This function constrains the selected vertices of the given object along a line</span>
<span class="sd">    defined by the center of mass (COM) and the long axis of the object. </span>
<span class="sd">    The selected vertices are resized to create a constriction effect.</span>

<span class="sd">    :param obj: The Blender cell object to constrict.</span>
<span class="sd">    :type obj: bpy.types.Object</span>
<span class="sd">    :param indices: A list of vertex indices to be constricted.</span>
<span class="sd">    :type indices: list[int]</span>

<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define the two tuple coordinates that define the line</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">get_long_axis_global</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;COM: </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">, long axis: </span><span class="si">{</span><span class="n">p2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Set the active object and get the evaluated mesh</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
    
    <span class="c1"># Get the edit-mode mesh and create a BMesh</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># Sort the indices to ensure that the vertices are selected in order</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;EDIT&#39;</span><span class="p">)</span> 
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                             <span class="n">orient_type</span><span class="o">=</span><span class="s1">&#39;GLOBAL&#39;</span><span class="p">,</span>
                             <span class="n">orient_matrix</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                             <span class="n">orient_matrix_type</span><span class="o">=</span><span class="s1">&#39;GLOBAL&#39;</span><span class="p">,</span> <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">use_proportional_edit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">proportional_edit_falloff</span><span class="o">=</span><span class="s1">&#39;SHARP&#39;</span><span class="p">,</span>
                             <span class="n">proportional_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_proportional_connected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">use_proportional_projected</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Update the view</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">reveal</span><span class="p">()</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_division_angles"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.get_division_angles">[docs]</a><span class="k">def</span> <span class="nf">get_division_angles</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span> 

    <span class="c1"># Get the active object</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

    <span class="c1"># Define the two tuple coordinates that define the line</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">get_long_axis_global</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

    <span class="c1"># Get the vector representing the line</span>
    <span class="n">line_vector</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

    <span class="c1"># Calculate a second perpendicular vector</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">line_vector</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.999</span><span class="p">:</span>
        <span class="n">up_dir</span> <span class="o">=</span> <span class="n">line_vector</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">up_dir</span> <span class="o">=</span> <span class="n">line_vector</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="n">up_dir</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

    <span class="c1"># Calculate a third perpendicular vector</span>
    <span class="n">side_dir</span> <span class="o">=</span> <span class="n">line_vector</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">up_dir</span><span class="p">)</span>
    <span class="n">side_dir</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="c1"># Calculate the quaternion that rotates the plane to align with the line direction</span>
    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">((</span><span class="n">side_dir</span><span class="p">,</span> <span class="n">up_dir</span><span class="p">,</span> <span class="n">line_vector</span><span class="p">))</span><span class="o">.</span><span class="n">transposed</span><span class="p">()</span>
    <span class="n">quat</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">to_quaternion</span><span class="p">()</span>
    <span class="c1"># Get a reference to the created plane object</span>
    <span class="n">plane_obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="c1"># Set the plane&#39;s rotation</span>
    <span class="n">plane_obj</span><span class="o">.</span><span class="n">rotation_mode</span> <span class="o">=</span> <span class="s1">&#39;QUATERNION&#39;</span>
    <span class="n">plane_obj</span><span class="o">.</span><span class="n">rotation_quaternion</span> <span class="o">=</span> <span class="n">quat</span>

    <span class="c1"># Set the active object and get the evaluated mesh</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">cell</span>
    <span class="n">cell_eval</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">())</span>
    <span class="n">mesh_eval</span> <span class="o">=</span> <span class="n">cell_eval</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>

    <span class="c1"># List of intersection vertices</span>
    <span class="n">intersection_verts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">mesh_eval</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vert</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">):</span>
            <span class="c1"># Transform the vertex coordinate to global coordinates</span>
            <span class="n">vert_coord</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">vert</span><span class="o">.</span><span class="n">co</span>
            <span class="c1"># Calculate the distance of the vertex from the plane</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">vert_coord</span> <span class="o">-</span> <span class="n">Vector</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">line_vector</span><span class="p">)</span>
            <span class="c1"># Check if the vertex is within the desired distance from the plane</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="n">intersection_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vert_coord</span><span class="p">)</span>
                <span class="c1"># Move the vertex towards the mesh center of mass</span>
                <span class="n">vert_coord</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">vert_coord</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">Vector</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="c1"># Transform the vertex coordinate back to local coordinates</span>
                <span class="n">local_vert_coord</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span> <span class="o">@</span> <span class="n">vert_coord</span>
                <span class="c1"># Update the vertex coordinate in the mesh data</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vert</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">local_vert_coord</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intersect coord: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">intersection_verts</span><span class="p">)</span><span class="si">}</span><span class="s2"> vertices, </span><span class="si">{</span><span class="n">intersection_verts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create new vertices from intersection coordinates</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Intersection&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Intersection&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># Set the mesh data</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">from_pydata</span><span class="p">(</span><span class="n">intersection_verts</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Create a new curve object and add a new spline to it</span>
    <span class="n">curve_data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyCurve&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CURVE&#39;</span><span class="p">)</span>
    <span class="n">curve_data</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="s1">&#39;3D&#39;</span>
    <span class="n">curve_data</span><span class="o">.</span><span class="n">resolution_u</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">curve_spline</span> <span class="o">=</span> <span class="n">curve_data</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;POLY&#39;</span><span class="p">)</span>
    <span class="n">curve_spline</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Set the points of the spline to the line points</span>
    <span class="n">curve_spline</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="o">.</span><span class="n">to_4d</span><span class="p">()</span>
    <span class="n">curve_spline</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">to_4d</span><span class="p">()</span>
    <span class="c1"># Set the line thickness</span>
    <span class="n">curve_data</span><span class="o">.</span><span class="n">bevel_depth</span> <span class="o">=</span> <span class="mf">0.03</span>
    <span class="c1"># Create a new object with the curve data</span>
    <span class="n">curve_object</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyCurveObject&#39;</span><span class="p">,</span> <span class="n">object_data</span><span class="o">=</span><span class="n">curve_data</span><span class="p">)</span>
    <span class="c1"># Add the object to the scene</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">curve_object</span><span class="p">)</span>  </div>


<div class="viewcode-block" id="handler_class"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class">[docs]</a><span class="k">class</span> <span class="nc">handler_class</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for creating different types of handlers that trigger</span>
<span class="sd">    actions on ``Goo`` cells when certain criteria are met.</span>

<span class="sd">    The initialization function specifies available cell types and associated</span>
<span class="sd">    parameters like division rate, growth rate, and adhesion forces. It also</span>
<span class="sd">    initializes various data containers for simulation metrics.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The initialization function specifies available cell types and associated</span>
    <span class="c1"># parameters like division rate, growth rate, and adhesion forces</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the handler class with default parameters and data containers.</span>

<span class="sd">        The initialization function specifies available cell types and associated</span>
<span class="sd">        parameters like division rate, growth rate, and adhesion forces. It also</span>
<span class="sd">        initializes various data containers for simulation metrics.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For adhesion handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Data handler: for total distance between cells - simulation stability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falloff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.master_dict = None</span>

        <span class="c1"># Data handler: for phase diagrams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stable_measure</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tension</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adhesion</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># For long axis</span>
        <span class="c1"># self.vec_axis = defaultdict(list)</span>
        <span class="c1"># self.len_axis = defaultdict(list)</span>

        <span class="c1"># Data handler: for contact area </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contact_ratios</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contact_areas</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># For cell division</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">division_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># For cell growth </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressures</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># For random motion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorting_scores</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msd</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># Data handler: flag in launch simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_flag</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span>

<div class="viewcode-block" id="handler_class.launch_simulation"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.launch_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">launch_simulation</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filepath</span><span class="p">,</span>
            <span class="n">volume_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">division_rate</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="n">motion_strength</span><span class="o">=-</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">division_trigger</span><span class="o">=</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span>
            <span class="n">adhesion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">growth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">division</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">motility</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="c1"># remeshing=False,</span>
            <span class="c1"># visualize=False,</span>
            <span class="n">boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Launches the simulation with specified parameters.</span>

<span class="sd">        This method initializes and launches the simulation based on the provided </span>
<span class="sd">        parameters. It sets up event handlers for various simulation aspects, </span>
<span class="sd">        including adhesion, data export, growth, division, motility, and boundary </span>
<span class="sd">        conditions.</span>

<span class="sd">        :param str filepath: The file path to save simulation data.</span>
<span class="sd">        :param float volume_scale: Scaling factor for cell volumes.</span>
<span class="sd">        :param int division_rate: The rate at which cells undergo division (in frames).</span>
<span class="sd">        :param int start: The starting frame of the simulation.</span>
<span class="sd">        :param int end: The ending frame of the simulation.</span>
<span class="sd">        :param int motion_strength: Strength of motion applied to cells.</span>
<span class="sd">        :param str division_trigger: The trigger for cell division (&#39;volume&#39; or \</span>
<span class="sd">              &#39;random&#39;).</span>
<span class="sd">        :param bool adhesion: Enable/disable adhesion in the simulation.</span>
<span class="sd">        :param bool growth: Enable/disable cell growth in the simulation.</span>
<span class="sd">        :param bool division: Enable/disable cell division in the simulation.</span>
<span class="sd">        :param bool data: Enable/disable data export during the simulation.</span>
<span class="sd">        :param bool motility: Enable/disable cell motility in the simulation.</span>
<span class="sd">        :param bool boundary: Enable/disable boundary conditions in the simulation.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_set</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">division_rate</span> <span class="o">=</span> <span class="n">division_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_strength</span> <span class="o">=</span> <span class="n">motion_strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_flag</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># used to decide if data are computed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">division_trigger</span> <span class="o">=</span> <span class="n">division_trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span> <span class="o">=</span> <span class="n">volume_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Set the end frame for all cloth simulation caches in the scene</span>
        <span class="c1"># To keep simulations running after the default 250 frames</span>
        <span class="k">if</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="c1"># Loop through the objects existed in the collection </span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>     
                    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">point_cache</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="n">start</span>   
                        <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">point_cache</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="n">end</span>   

        <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_init_handler</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">adhesion</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adhesion_handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_export_handler</span><span class="p">)</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_area_handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">growth</span><span class="p">:</span>
            <span class="c1"># bpy.app.handlers.frame_change_post.append(self.growth_handler)</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">growth_pressure_handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">division</span> <span class="ow">and</span> <span class="n">division_trigger</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">):</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">division_handler_random</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">division</span> <span class="ow">and</span> <span class="n">division_trigger</span> <span class="o">==</span> <span class="s1">&#39;volume&#39;</span><span class="p">):</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">division_handler_volume</span><span class="p">)</span>            
        <span class="k">if</span> <span class="n">motility</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_handler</span><span class="p">)</span>
        <span class="c1"># if visualize:</span>
        <span class="c1">#    bpy.app.handlers.frame_change_post.append(self.visualize_stretching)</span>

        <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_elapsed_handler</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">frame_change_post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">)</span>

        <span class="c1"># bpy.ops.screen.animation_play()</span>

        <span class="k">return</span> </div>

<div class="viewcode-block" id="handler_class.remeshing_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.remeshing_handler">[docs]</a>    <span class="k">def</span> <span class="nf">remeshing_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handlers responsible for remeshing cells at every time step.</span>

<span class="sd">        It iterates over the cell objects in the scene, declares a remeshing modifier, </span>
<span class="sd">        and adjusts the mesh properties.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">remesh_frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># div_frames = range(self.frame_interval[0], self.frame_interval[1], 1)[1:]</span>
        <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="ow">in</span> <span class="n">remesh_frames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="c1"># Exclude the objects in the force collections</span>
                <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span>
                    <span class="n">cells</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">name_full</span><span class="p">)</span><span class="o">.</span><span class="n">all_objects</span>
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                        <span class="n">cell</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span><span class="p">:</span>
                        <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_tmp_</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;REMESH&#39;</span>
                            <span class="p">)</span>
                        <span class="n">remesh_mod</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remesh_tmp_</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;VOXEL&#39;</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># microns</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">adaptivity</span> <span class="o">=</span> <span class="mi">0</span> 
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_remove_disconnected</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">use_smooth_shade</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">show_in_editmode</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">remesh_mod</span><span class="o">.</span><span class="n">show_in_editmode</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_move_to_index</span><span class="p">(</span>
                            <span class="n">modifier</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_tmp_</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=-</span><span class="mi">1</span>
                            <span class="p">)</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> \
                            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>      
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span>
                            <span class="n">modifier</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remesh_tmp_</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="c1"># deselect all vertices in edit mode</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;EDIT&#39;</span><span class="p">)</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">select_mode</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VERT&quot;</span><span class="p">)</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">reveal</span><span class="p">()</span>
                        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="handler_class.division_handler_random"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.division_handler_random">[docs]</a>    <span class="k">def</span> <span class="nf">division_handler_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">despgraph</span><span class="p">):</span>

        <span class="n">div_frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">division_rate</span>
            <span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">div_frames_physics</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">division_rate</span>
            <span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">div_frames_forces</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">division_rate</span>
            <span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                    
        <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="ow">in</span> <span class="n">div_frames</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">mother_adhesion_strength</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># self.force_collection = None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falloff</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Get cells that are candidates for division</span>
            <span class="n">target_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span>
            <span class="n">threshold_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span> <span class="o">*</span> <span class="mf">0.05</span>

            <span class="n">candidate_cells</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span> <span class="ow">and</span> 
                    <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> 
                    <span class="nb">abs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">target_volume</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">threshold_volume</span>
                <span class="p">)</span>
            <span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Candidate cells: </span><span class="si">{</span><span class="n">candidate_cells</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">candidate_cells</span><span class="p">:</span>
                <span class="c1"># Select the largest cell among 5% error from target volume</span>
                <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">candidate_cells</span><span class="p">]</span>
                <span class="n">largest_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
                <span class="n">largest_cell</span> <span class="o">=</span> <span class="n">candidate_cells</span><span class="p">[</span><span class="n">volumes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">largest_volume</span><span class="p">)]</span>
                <span class="c1"># Replace with cell to divide    </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="o">=</span> <span class="n">largest_cell</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="o">=</span> <span class="kc">None</span> 
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># Get name of cell under division</span>
                <span class="c1"># cell_name = self.cell_under_div.name</span>
                <span class="c1"># Get the object by name</span>
                <span class="n">dividing_cell</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="w">                </span><span class="sd">&#39;&#39;&#39;# If cell object exists</span>
<span class="sd">                if obj:</span>
<span class="sd">                    # Get cloth modifier and check if it exists</span>
<span class="sd">                    cloth_modifier = obj.modifiers.get(&#39;Cloth&#39;)</span>
<span class="sd">                    if cloth_modifier:</span>
<span class="sd">                        mother_stiffness = cloth_modifier.settings.tension_stiffness</span>
<span class="sd">                    else:</span>
<span class="sd">                        raise ValueError(f&quot;No Cloth modifier found on {cell_name}&quot;)</span>
<span class="sd">                else:</span>
<span class="sd">                    raise ValueError(f&quot;Object &#39;{cell_name}&#39; not found&quot;)&#39;&#39;&#39;</span>
                
                <span class="n">apply_modifiers</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">dividing_cell</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

                <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">mother_adhesion_strength</span><span class="p">,</span> <span class="n">mother_motion_strength</span><span class="p">,</span> \
                    <span class="n">tmp_falloff</span><span class="p">,</span> <span class="n">mother_adhesion</span><span class="p">,</span> <span class="n">mother_modifiers</span> <span class="o">=</span> \
                    <span class="n">divide_boolean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span><span class="p">)</span>

                <span class="c1"># Pass on force info to daugther cells  </span>
                <span class="c1"># self.mother_adhesion_strength = mother_adhesion_strength</span>
                <span class="c1"># self.mother_motion_strength = mother_motion_strength</span>
                <span class="c1"># self.force_collection = tmp_collection</span>
                <span class="c1"># self.falloff = tmp_falloff</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span> <span class="o">=</span> <span class="n">mother_adhesion</span>
                <span class="c1"># self.mother_stiffness = mother_stiffness</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>     
                <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- Finishing division of </span><span class="si">{</span><span class="n">dividing_cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;at frame </span><span class="si">{</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No cells under division&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 

            <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="ow">in</span> <span class="n">div_frames_physics</span><span class="p">:</span> 

                <span class="c1"># Toggle back on physics after mesh separation</span>
                <span class="n">apply_physics</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                              <span class="n">stiffness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span><span class="p">)</span>
                <span class="n">apply_physics</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">stiffness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">:</span>
                    <span class="n">cells_same_type</span> <span class="o">=</span> <span class="n">get_cells_same_type</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cell_same_type</span> <span class="ow">in</span> <span class="n">cells_same_type</span><span class="p">:</span>
                        <span class="n">missing_forces</span> <span class="o">=</span> <span class="n">get_missing_adhesion_forces</span><span class="p">(</span><span class="n">cell_same_type</span><span class="p">,</span> 
                                                                     <span class="n">cell</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">missing_forces</span><span class="p">:</span>
                            <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="ow">in</span> <span class="n">div_frames_forces</span><span class="p">:</span> 

                <span class="c1"># Add adhesion forces to daugther cells</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span><span class="p">:</span> 
                    <span class="n">add_homo_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                                      <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span><span class="p">)</span>
                    <span class="n">add_homo_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                                      <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span><span class="p">)</span>

        <span class="c1"># CODE FOR TO SPHERE IMPLEMENTATION</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;div_frames_sphere = range(</span>
<span class="sd">            self.frame_interval[0] + 2, </span>
<span class="sd">            self.frame_interval[1], </span>
<span class="sd">            self.division_rate</span>
<span class="sd">            [1:]</span>
<span class="sd">        frames = range(div_frames[0], div_frames[0] + len(rates), 1)</span>

<span class="sd">        if scene.frame_current in sphere_frames: </span>

<span class="sd">            bpy.context.view_layer.objects.active = self.daugthers[0]</span>
<span class="sd">            to_sphere(</span>
<span class="sd">                self.daugthers[0], </span>
<span class="sd">                rates[sphere_frames.index(scene.frame_current)]</span>
<span class="sd">                )</span>
<span class="sd">            #bpy.context.view_layer.objects.active = None</span>

<span class="sd">            bpy.context.view_layer.objects.active = self.daugthers[1]</span>
<span class="sd">            to_sphere(</span>
<span class="sd">                self.daugthers[1], </span>
<span class="sd">                rates[sphere_frames.index(scene.frame_current)]</span>
<span class="sd">                )&#39;&#39;&#39;</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;for collection in bpy.data.collections:</span>

<span class="sd">            target_volume = self.unit_volume * self.volume_scale</span>
<span class="sd">            threshold_volume = self.volume_scale * self.unit_volume * 0.05</span>

<span class="sd">            candidate_cell = [</span>
<span class="sd">                obj for obj</span>
<span class="sd">                in collection.all_objects</span>
<span class="sd">                if (</span>
<span class="sd">                    obj.get(&#39;object&#39;) == &#39;cell&#39; and </span>
<span class="sd">                    &#39;volume&#39; in obj and (abs(obj.get(&#39;volume&#39;) - target_volume) </span>
<span class="sd">                                         &lt;= threshold_volume)</span>
<span class="sd">                )</span>
<span class="sd">            ]</span>
<span class="sd">        </span>
<span class="sd">            # Loop through only the cell objects in collections</span>
<span class="sd">            cells = [</span>
<span class="sd">                obj for obj </span>
<span class="sd">                in bpy.data.collections.get(collection.name_full).all_objects </span>
<span class="sd">                if obj.get(&#39;object&#39;) == &#39;cell&#39;</span>
<span class="sd">            ]</span>
<span class="sd">            print(f&quot;All cells: {cells}&quot;)</span>

<span class="sd">            # Filter cells with volume around 5% of the target volume</span>
<span class="sd">            target_volume = self.unit_volume * self.volume_scale</span>
<span class="sd">            threshold_volume = self.volume_scale * self.unit_volume * 0.05</span>
<span class="sd">            candidate_cell = [</span>
<span class="sd">                cell for cell in cells </span>
<span class="sd">                if &#39;volume&#39; in cell and (abs(cell[&#39;volume&#39;] - target_volume) </span>
<span class="sd">                                         &lt;= threshold_volume)</span>
<span class="sd">            ]&#39;&#39;&#39;</span></div>
<span class="w">        </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;# poor results because creates overlapping meshes    </span>
<span class="sd">    def cast_modifier(self, scene, despgraph):</span>
<span class="sd">        # Iterate through all objects in the scene</span>
<span class="sd">        for obj in bpy.context.scene.objects:</span>
<span class="sd">            # Check if the object is a cell object (customize the condition as needed)</span>
<span class="sd">            if obj.get(&#39;object&#39;) == &#39;cell&#39;:  # Example condition for cell objects</span>
<span class="sd">                modifier_exists = False</span>
<span class="sd">                </span>
<span class="sd">                # Check if a Cast modifier already exists, if yes, update its factor</span>
<span class="sd">                for modifier in obj.modifiers:</span>
<span class="sd">                    if modifier.type == &#39;CAST&#39;:</span>
<span class="sd">                        modifier_exists = True</span>
<span class="sd">                        if modifier.factor &lt; -0.5:</span>
<span class="sd">                            continue</span>
<span class="sd">                        else:</span>
<span class="sd">                            # Decrease factor by 0.1 (adjust as needed)</span>
<span class="sd">                            modifier.factor -= 0.001</span>
<span class="sd">                            break</span>
<span class="sd">                </span>
<span class="sd">                # If no Cast modifier exists, create a new one</span>
<span class="sd">                if not modifier_exists:</span>
<span class="sd">                    cast_modifier = obj.modifiers.new(name=&quot;Cast&quot;, type=&#39;CAST&#39;)</span>
<span class="sd">                    cast_modifier.factor = 0.0  # Start factor from 0&#39;&#39;&#39;</span>

<div class="viewcode-block" id="handler_class.division_handler_volume"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.division_handler_volume">[docs]</a>    <span class="k">def</span> <span class="nf">division_handler_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">despgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for cell division based on volume criteria.</span>

<span class="sd">        This method is responsible for cell division based on volume criteria </span>
<span class="sd">        during the simulation. It loop over all cells, identifies candidate </span>
<span class="sd">        cells for division, selects the largest one, and then divides </span>
<span class="sd">        into two daughter cells.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param despgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falloff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_motion</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">candidate_cells</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get cells that are candidates for division</span>
        <span class="n">target_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span>
        <span class="c1"># threshold_volume = self.volume_scale * self.unit_volume * 0.05</span>

        <span class="n">candidate_cells</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span> <span class="ow">and</span> 
                <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> 
                <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">target_volume</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Candidate cells: </span><span class="si">{</span><span class="n">candidate_cells</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">candidate_cells</span><span class="p">:</span>
            <span class="c1"># print(f&quot;Candidate cells: {candidate_cells}&quot;)</span>
            <span class="c1"># Select the largest cell among 5% error from target volume</span>
            <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">candidate_cells</span><span class="p">]</span>
            <span class="n">largest_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
            <span class="n">largest_cell</span> <span class="o">=</span> <span class="n">candidate_cells</span><span class="p">[</span><span class="n">volumes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">largest_volume</span><span class="p">)]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Largest cell: </span><span class="si">{</span><span class="n">largest_cell</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Replace with cell to divide    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="o">=</span> <span class="n">largest_cell</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="o">=</span> <span class="kc">None</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cell under division: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Get name of cell under division</span>
            <span class="c1"># cell_name = self.cell_under_div.name</span>
            <span class="c1"># Get the object by name</span>
            <span class="n">dividing_cell</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_under_div</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># If cell object exists</span>
            <span class="k">if</span> <span class="n">dividing_cell</span><span class="p">:</span>
                <span class="c1"># Get cloth modifier and check if it exists</span>
                <span class="n">cloth_modifier</span> <span class="o">=</span> <span class="n">dividing_cell</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cloth&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cloth_modifier</span><span class="p">:</span>
                    <span class="n">mother_stiffness</span> <span class="o">=</span> <span class="n">cloth_modifier</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">tension_stiffness</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Cloth modifier found on </span><span class="si">{</span><span class="n">dividing_cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object &#39;</span><span class="si">{</span><span class="n">dividing_cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
            
            <span class="n">mother_subsurf</span> <span class="o">=</span> <span class="n">store_subsurf_settings</span><span class="p">(</span><span class="n">dividing_cell</span><span class="p">)</span>
            <span class="n">mother_cloth</span> <span class="o">=</span> <span class="n">store_cloth_settings</span><span class="p">(</span><span class="n">dividing_cell</span><span class="p">)</span>
            <span class="n">mother_collision</span> <span class="o">=</span> <span class="n">store_collision_settings</span><span class="p">(</span><span class="n">dividing_cell</span><span class="p">)</span>
            <span class="n">mother_remesher</span> <span class="o">=</span> <span class="n">store_remesh_settings</span><span class="p">(</span><span class="n">dividing_cell</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -- Mother subsurf: </span><span class="si">{</span><span class="n">mother_subsurf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -- Mother Cloth: </span><span class="si">{</span><span class="n">mother_cloth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -- Mother collision: </span><span class="si">{</span><span class="n">mother_collision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -- Mother remesher: </span><span class="si">{</span><span class="n">mother_remesher</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Apply the whole modifer stack in sequential order    </span>
            <span class="n">apply_modifiers</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">dividing_cell</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

            <span class="c1"># Separation of mother in two distinct daughter cells</span>
            <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">mother_adhesion_strength</span><span class="p">,</span> <span class="n">mother_motion_strength</span><span class="p">,</span> \
                <span class="n">tmp_falloff</span><span class="p">,</span> <span class="n">mother_adhesion</span><span class="p">,</span> <span class="n">mother_motion</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
                <span class="n">divide_boolean</span><span class="p">(</span><span class="n">dividing_cell</span><span class="p">)</span>
            
            <span class="c1"># Pass on force parameters to daugther cells  </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span> <span class="o">=</span> <span class="n">mother_adhesion_strength</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_motion_strength</span> <span class="o">=</span> <span class="n">mother_motion_strength</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falloff</span> <span class="o">=</span> <span class="n">tmp_falloff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span> <span class="o">=</span> <span class="n">mother_adhesion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_motion</span> <span class="o">=</span> <span class="n">mother_motion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span> <span class="o">=</span> <span class="n">mother_stiffness</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>     
            <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>

            <span class="c1"># declare modifiers mother -&gt; daughter</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;declare_subsurf_settings(self.daugthers[1], mother_subsurf)</span>
<span class="sd">            declare_subsurf_settings(self.daugthers[0], mother_subsurf)</span>

<span class="sd">            declare_cloth_settings(self.daugthers[1], mother_cloth)</span>
<span class="sd">            declare_cloth_settings(self.daugthers[0], mother_cloth)            </span>

<span class="sd">            declare_collision_settings(self.daugthers[1], mother_collision)</span>
<span class="sd">            declare_collision_settings(self.daugthers[0], mother_collision)            </span>

<span class="sd">            declare_remesh_settings(self.daugthers[1], mother_remesher)</span>
<span class="sd">            declare_remesh_settings(self.daugthers[0], mother_remesher)&#39;&#39;&#39;</span>         

            <span class="c1"># Toggle back on physics after mesh separation</span>
            <span class="n">apply_physics</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                          <span class="n">stiffness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span><span class="p">)</span>
            <span class="n">apply_physics</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                          <span class="n">stiffness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_stiffness</span><span class="p">)</span>

            <span class="c1"># Add adhesion forces to daugther cells</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mother adhesion detected, passing it on&#39;</span><span class="p">)</span>
                <span class="n">add_homo_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                                  <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span><span class="p">)</span>
                <span class="n">add_homo_adhesion</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                                  <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_adhesion_strength</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">:</span>
                    <span class="n">cells_same_type</span> <span class="o">=</span> <span class="n">get_cells_same_type</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cell_same_type</span> <span class="ow">in</span> <span class="n">cells_same_type</span><span class="p">:</span>
                        <span class="n">missing_forces</span> <span class="o">=</span> <span class="n">get_missing_adhesion_forces</span><span class="p">(</span><span class="n">cell_same_type</span><span class="p">,</span> 
                                                                     <span class="n">cell</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing adhesion forces: </span><span class="si">{</span><span class="n">missing_forces</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">missing_forces</span><span class="p">:</span>
                            <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_motion</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mother motion detected, passing it on&#39;</span><span class="p">)</span>
                <span class="n">add_motion</span><span class="p">(</span><span class="n">effector_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                           <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_motion_strength</span><span class="p">)</span>
                <span class="n">add_motion</span><span class="p">(</span><span class="n">effector_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daugthers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                           <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mother_motion_strength</span><span class="p">)</span>
                
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- Finishing division of </span><span class="si">{</span><span class="n">dividing_cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;at frame </span><span class="si">{</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="handler_class.growth_pressure_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.growth_pressure_handler">[docs]</a>    <span class="k">def</span> <span class="nf">growth_pressure_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for cell growth based on cell&#39;s pressure.</span>

<span class="sd">        This method calculates the volume and target volume of each cell, </span>
<span class="sd">        adjusts the uniform pressure force based on the deviation from the </span>
<span class="sd">        target volume, and updates the pressure settings accordingly.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
            <span class="n">cells</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">name_full</span><span class="p">)</span><span class="o">.</span><span class="n">all_objects</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cloth&#39;</span><span class="p">):</span>
                    <span class="n">volume</span> <span class="o">=</span> <span class="n">calculate_volume</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                    <span class="n">target_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;target volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_volume</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pressures</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span>
                    <span class="p">)</span>
                    <span class="n">volume_deviation</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_volume</span> <span class="o">-</span> <span class="n">volume</span><span class="p">)</span> <span class="o">/</span> <span class="n">target_volume</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Volume deviation: </span><span class="si">{</span><span class="n">volume_deviation</span><span class="si">}</span><span class="s2">; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Target volume: </span><span class="si">{</span><span class="n">target_volume</span><span class="si">}</span><span class="s2">; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Volume: </span><span class="si">{</span><span class="n">volume</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="c1"># Define the pressure-volume relationship </span>
                    <span class="n">previous_pressure</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;previous pressure&#39;</span><span class="p">)</span>
                    <span class="c1"># Modify pressure based on volume deviation</span>
                    <span class="c1"># delta_pressure = 0.001 * (math.exp(volume_deviation) - 1)</span>
                    <span class="c1"># print(f&quot;Delta pressure: {delta_pressure}&quot;)</span>
                    <span class="n">new_pressure</span> <span class="o">=</span> <span class="n">previous_pressure</span> <span class="o">+</span> <span class="p">(</span><span class="n">volume_deviation</span>
                                                        <span class="o">*</span> <span class="n">previous_pressure</span><span class="o">*</span><span class="mf">0.03</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New pressure: </span><span class="si">{</span><span class="n">new_pressure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Update the cloth pressure settings</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">uniform_pressure_force</span> <span class="o">=</span> \
                        <span class="n">new_pressure</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;previous pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_pressure</span>                                                    </div>

    <span class="c1"># Member function to handle cell growth</span>
<div class="viewcode-block" id="handler_class.growth_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.growth_handler">[docs]</a>    <span class="k">def</span> <span class="nf">growth_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for cell growth based on mesh scaling.</span>

<span class="sd">        This method calculates the volume and target volume of each cell, </span>
<span class="sd">        adjusts the shrink_min parameter of the Cloth modifier based on </span>
<span class="sd">        the deviation from the target volume, resulting in mesh scaling </span>
<span class="sd">        and mimicking cell growth.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
            <span class="c1"># Loop through the cell objects in collections, excluding forces</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">name_full</span><span class="p">)</span><span class="o">.</span><span class="n">all_objects</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span> 
                <span class="k">if</span> <span class="p">(</span>
                    <span class="c1"># cell.get(&#39;adhesion force&#39;) is not None or</span>
                    <span class="c1"># cell.get(&#39;motion force&#39;) is not None or</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cloth&#39;</span><span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">volume</span> <span class="o">=</span> <span class="n">calculate_volume</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                    <span class="c1"># target_volume = ((4/3)*np.pi*(1)**3)</span>
                    <span class="n">target_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_volume</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;target volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_volume</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>

                    <span class="c1"># TODO allow for multiple growth rate, with different functions</span>
                    <span class="n">volume_deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">volume</span> <span class="o">-</span> <span class="n">target_volume</span><span class="p">)</span> <span class="o">/</span> <span class="n">target_volume</span><span class="p">)</span>
                    <span class="c1"># (f&quot;Current volume deviation: {volume_deviation}&quot;)</span>
                    <span class="c1"># shrink_adjustment = 0.001 * math.tanh(50 * volume_deviation)</span>
                    <span class="n">shrink_adjustment</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">volume_deviation</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># shrink_adjustment = 0.01 * volume_deviation</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">shrink_min</span> <span class="o">+=</span> <span class="n">shrink_adjustment</span>

                    <span class="c1"># volume control</span>
<span class="w">                    </span><span class="sd">&#39;&#39;&#39;if volume &lt; (target_volume - target_volume * 0.2): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is lower&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 20%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min -= 0.01</span>
<span class="sd">                    elif volume &lt; (target_volume - target_volume * 0.05): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is lower&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 5%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min -= 0.001</span>
<span class="sd">                    elif volume &lt; (target_volume - target_volume * 0.01): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is lower&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 1%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min -= 0.0005</span>
<span class="sd">                    # shrink</span>
<span class="sd">                    elif volume &gt; (target_volume + target_volume * 0.2): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is higher&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 20%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min += 0.01</span>
<span class="sd">                    elif volume &gt; (target_volume + target_volume * 0.05): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is higher&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 5%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min += 0.001</span>
<span class="sd">                    elif volume &lt; (target_volume + target_volume * 0.01): </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is higher&quot;</span>
<span class="sd">                              f&quot;than target {target_volume} - 1%&quot;)</span>
<span class="sd">                        cell.modifiers[&quot;Cloth&quot;].settings.shrink_min += 0.0005</span>
<span class="sd">                    else: </span>
<span class="sd">                        print(f&quot;Current volume: {volume} is within&quot;</span>
<span class="sd">                              f&quot;target {target_volume}&quot;)&#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="handler_class.boundary_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.boundary_handler">[docs]</a>    <span class="k">def</span> <span class="nf">boundary_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for enforcing reflective boundaries on motion forces.</span>

<span class="sd">        This method ensures that motion forces are constrained within the boundaries </span>
<span class="sd">        of a specified box or sphere. If a force location exceeds the box boundaries, </span>
<span class="sd">        it is reflected back into the box.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the &#39;box&#39; object, per convention</span>
        <span class="n">box_object</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">box_object</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">box_object</span><span class="p">:</span>
            <span class="c1"># Get the size and center from the object name</span>
            <span class="n">box_dimensions</span> <span class="o">=</span> <span class="n">box_object</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">box_center</span> <span class="o">=</span> <span class="n">box_object</span><span class="o">.</span><span class="n">location</span>

            <span class="c1"># Calculate the boundaries of the box</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_max</span> <span class="o">=</span> <span class="n">box_center</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">box_dimensions</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
                <span class="n">forces</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">name_full</span><span class="p">)</span><span class="o">.</span><span class="n">all_objects</span>
                <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)):</span> 

                        <span class="n">constrained_force_location</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">location</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Before constrained: </span><span class="si">{</span><span class="n">force</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="c1"># Reflect x-coordinate if it&#39;s outside the box boundaries</span>
                        <span class="k">if</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">x_min</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">x_min</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span>
                        <span class="k">elif</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">x_max</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span>

                        <span class="c1"># Reflect y-coordinate if it&#39;s outside the box boundaries</span>
                        <span class="k">if</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">y_min</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">y_min</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span>
                        <span class="k">elif</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">y_max</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span>

                        <span class="c1"># Reflect z-coordinate if it&#39;s outside the box boundaries</span>
                        <span class="k">if</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="n">z_min</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">z_min</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span>
                        <span class="k">elif</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="n">z_max</span><span class="p">:</span>
                            <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> \
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">z_max</span> <span class="o">-</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span>

                        <span class="n">force</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">constrained_force_location</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;After constrained: </span><span class="si">{</span><span class="n">force</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="c1"># Check if the force location is outside the box</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x_min</span> <span class="o">&lt;=</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_max</span> <span class="ow">and</span>
                                <span class="n">y_min</span> <span class="o">&lt;=</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">y_max</span> <span class="ow">and</span>
                                <span class="n">z_min</span> <span class="o">&lt;=</span> <span class="n">constrained_force_location</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="n">z_max</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;Force location is outside the box boundaries.&quot;</span>
                                <span class="p">)</span></div>

<div class="viewcode-block" id="handler_class.motion_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.motion_handler">[docs]</a>    <span class="k">def</span> <span class="nf">motion_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 
        
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span> 
            <span class="k">if</span> <span class="s2">&quot;object&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cell&quot;</span>
            <span class="p">]</span>
        <span class="c1"># print(cells)</span>
        <span class="n">msd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>        
        
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span> 
            <span class="n">forces</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">name_full</span><span class="p">)</span><span class="o">.</span><span class="n">all_objects</span>
            <span class="c1"># print(forces)</span>
            <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)):</span> 
                    <span class="c1"># print(&#39;Entering force loop&#39;)</span>
                    <span class="c1"># self.force_path[f&#39;{force.name}_force_tracks&#39;].append(tuple(force.location))</span>
                    <span class="n">cell</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">)]</span>
                    <span class="n">com</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;current position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">com</span>
                    <span class="n">disp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current position&#39;</span><span class="p">))</span> <span class="o">-</span> 
                            <span class="n">Vector</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;past position&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">length</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">com</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">location</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                    <span class="c1"># Mean Squared Displacement for single particle</span>
                    <span class="n">sq_displacement_cell</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> 
                        <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">length_squared</span>
                    <span class="n">sq_displacement_force</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> 
                        <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">length_squared</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msd</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sq_displacement_cell</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msd</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sq_displacement_force</span><span class="p">)</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;MSD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msd</span>
                    <span class="n">force</span><span class="p">[</span><span class="s1">&#39;MSD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msd</span>

                    <span class="k">if</span> <span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distribution&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;uniform&#39;</span><span class="p">:</span> 
                        <span class="c1"># print(&#39;Distribution is uniform&#39;)</span>
                        <span class="n">rand_coord</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                            <span class="n">low</span><span class="o">=-</span><span class="n">force</span><span class="p">[</span><span class="s1">&#39;distribution size&#39;</span><span class="p">],</span>
                            <span class="n">high</span><span class="o">=</span><span class="n">force</span><span class="p">[</span><span class="s1">&#39;distribution size&#39;</span><span class="p">],</span> 
                            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
                        <span class="p">))</span>
                        <span class="n">new_loc</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">com</span><span class="p">)</span> <span class="o">+</span> <span class="n">rand_coord</span>
                    <span class="k">elif</span> <span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distribution&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span> 
                        <span class="n">rand_coord</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                            <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                            <span class="n">scale</span><span class="o">=</span><span class="n">force</span><span class="p">[</span><span class="s1">&#39;distribution size&#39;</span><span class="p">],</span> 
                            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
                        <span class="p">))</span>
                        <span class="n">new_loc</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">com</span><span class="p">)</span> <span class="o">+</span> <span class="n">rand_coord</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distribution&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;is not a supported distribution&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    
                    <span class="n">force</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">new_loc</span>

<span class="w">                    </span><span class="sd">&#39;&#39;&#39;# cell tracks </span>
<span class="sd">                    # Define the name of the curve object and the new point coordinates</span>
<span class="sd">                    # Find the curve object by name</span>
<span class="sd">                    curve_obj = bpy.data.objects[f&#39;{cell.name}_tracks&#39;]</span>

<span class="sd">                    # Enter edit mode for the curve object</span>
<span class="sd">                    bpy.context.view_layer.objects.active = curve_obj</span>
<span class="sd">                    bpy.ops.object.mode_set(mode=&#39;EDIT&#39;)</span>

<span class="sd">                    # Add a new control point to the curve</span>
<span class="sd">                    spline = curve_obj.data.splines[0]</span>
<span class="sd">                    spline.points.add(1)</span>
<span class="sd">                    new_point_index = len(spline.points) - 1</span>
<span class="sd">                    spline.points[new_point_index].co = (*com, 1)</span>

<span class="sd">                    # Update the curve display and exit edit mode</span>
<span class="sd">                    bpy.ops.curve.reveal()</span>
<span class="sd">                    bpy.ops.object.mode_set(mode=&#39;OBJECT&#39;)</span>

<span class="sd">                    # force tracks</span>
<span class="sd">                    curve_force_obj = bpy.data.objects[f&#39;{force.name}_force_tracks&#39;]</span>

<span class="sd">                    # Enter edit mode for the curve object</span>
<span class="sd">                    bpy.context.view_layer.objects.active = curve_force_obj</span>
<span class="sd">                    bpy.ops.object.mode_set(mode=&#39;EDIT&#39;)</span>

<span class="sd">                    # Add a new control point to the curve</span>
<span class="sd">                    spline = curve_force_obj.data.splines[0]</span>
<span class="sd">                    spline.points.add(1)</span>
<span class="sd">                    new_point_index = len(spline.points) - 1</span>
<span class="sd">                    spline.points[new_point_index].co = (*force.location, 1)</span>

<span class="sd">                    # Update the curve display and exit edit mode</span>
<span class="sd">                    bpy.ops.curve.reveal()</span>
<span class="sd">                    bpy.ops.object.mode_set(mode=&#39;OBJECT&#39;)&#39;&#39;&#39;</span>

                    <span class="c1"># cells will only adhere with other cells </span>
                    <span class="c1"># that are in the same collection</span>
                    <span class="n">obj_cell</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">)]</span>
                    <span class="n">cloth_modifier</span> <span class="o">=</span> <span class="n">obj_cell</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span>
                    <span class="n">cloth_modifier</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">effector_weights</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span>
                    <span class="c1"># update position of cell</span>
                    <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;past position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">com</span>

                <span class="k">else</span><span class="p">:</span> 
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Motion handler is not working&#39;</span><span class="p">)</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;if scene.frame_current == self.frame_interval[1] - 1:</span>
<span class="sd">        # Iterate over all spline objects in the scene</span>
<span class="sd">            tracks = [</span>
<span class="sd">                obj </span>
<span class="sd">                for collection in bpy.data.collections </span>
<span class="sd">                for obj in collection.objects </span>
<span class="sd">                if obj.type == &#39;CURVE&#39;</span>
<span class="sd">                ]</span>
<span class="sd">            </span>
<span class="sd">            for obj in tracks:</span>
<span class="sd">                    # Initialize variables</span>
<span class="sd">                    spline = obj.data.splines[0]</span>
<span class="sd">                    points = spline.points</span>

<span class="sd">                    # Iterate over control points and calculate displacements</span>
<span class="sd">                    for i in range(1, len(points)):</span>
<span class="sd">                        intial_point = points[0].co</span>
<span class="sd">                        prev_point = points[i-1].co</span>
<span class="sd">                        curr_point = points[i].co</span>
<span class="sd">                        # Mean Squared Displacement for single particle</span>
<span class="sd">                        displacement = (curr_point - intial_point).length_squared</span>
<span class="sd">                        # Single particle speed</span>
<span class="sd">                        speed = (curr_point - prev_point).length</span>

<span class="sd">                        msd = displacement / 1</span>
<span class="sd">                        obj[&#39;MSD&#39;] = msd</span>

<span class="sd">                        self.msd[f&#39;{obj.name}&#39;].append(msd)</span>
<span class="sd">                        self.speed[f&#39;{obj.name}&#39;].append(speed)</span>
<span class="sd">                        self.motion_path[f&#39;{obj.name}&#39;].append(tuple(curr_point)[:3])&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_flag</span><span class="p">:</span> 
            <span class="c1"># Initialize a dictionary to store the sorting scores for each cell type</span>
            <span class="n">cell_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">coll</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;cells = [</span>
<span class="sd">                obj for obj in bpy.data.objects </span>
<span class="sd">                if &quot;object&quot; in obj.keys() and obj[&quot;object&quot;] == &quot;cell&quot;</span>
<span class="sd">                ]&#39;&#39;&#39;</span>

            <span class="n">neighbors</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> 
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> 
                    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">cell_type</span>
                <span class="p">}</span> 
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span>
            <span class="p">}</span>

            <span class="n">neighbors_same_type</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> 
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> 
                    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">cell_type</span>
                <span class="p">}</span> 
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span>
            <span class="p">}</span>

            <span class="n">sorting_scores</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> 
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> 
                    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">cell_type</span>
                <span class="p">}</span> 
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span>
            <span class="p">}</span>

            <span class="n">sorting_scores_same_type</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">cell_type</span><span class="p">:</span> <span class="mi">0</span> 
                <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span>
            <span class="p">}</span>

            <span class="c1"># loop for each cell</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">other_cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>  
                    <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other_cell</span><span class="p">:</span> 
                        <span class="c1"># get neighbors </span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span> <span class="o">-</span> 
                            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">other_cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;adhesion force&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">length</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">1.95</span><span class="p">:</span>
                            <span class="c1"># get number of neighbors for a specific cell</span>
                            <span class="n">neighbors</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                            <span class="c1"># get neighbors of same cell type</span>
                            <span class="n">other_type</span> <span class="o">=</span> <span class="n">other_cell</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">other_type</span>
                            <span class="p">):</span>
                                <span class="n">neighbor_type</span> <span class="o">=</span> <span class="n">neighbors_same_type</span><span class="p">[</span>
                                    <span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
                                    <span class="p">]</span>
                                <span class="n">neighbor_type</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># sorting is null if cell has no neighbors                 </span>
                <span class="k">if</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                    <span class="n">sorting_scores</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">sorting_scores</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">neighbors_same_type</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">/</span> 
                        <span class="n">neighbors</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;sorting score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sorting_scores</span><span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)][</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="p">)</span>
            
            <span class="c1"># avg sorting score over cells among the same type</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">cell_dict</span> <span class="ow">in</span> <span class="n">sorting_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">cell_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">sorting_scores_same_type</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">average</span>

            <span class="c1"># Print the sorting scores for each cell type</span>
            <span class="k">for</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">sorting_scores_same_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">coll</span> 
                    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span> 
                    <span class="k">if</span> <span class="n">coll</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span>
                <span class="p">]:</span>
                    <span class="n">coll</span><span class="p">[</span><span class="s1">&#39;sorting score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
                <span class="c1"># print(f&quot;Cell Type: {cell}, Sorting Score: {score}&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sorting_scores</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span><span class="p">:</span> <span class="n">sorting_scores_same_type</span><span class="p">})</span></div>

<div class="viewcode-block" id="handler_class.contact_area_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.contact_area_handler">[docs]</a>    <span class="k">def</span> <span class="nf">contact_area_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_flag</span><span class="p">:</span> 
            <span class="n">contact_ratio_dict</span><span class="p">,</span> <span class="n">contact_areas_dict</span> <span class="o">=</span> <span class="n">get_contact_area</span><span class="p">()</span>
            <span class="c1"># Merge the dictionaries</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">contact_ratio_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_ratios</span><span class="p">:</span>
                    <span class="c1"># If the key is not present in the master dictionary, </span>
                    <span class="c1"># create a new list with the current value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contact_ratios</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the key is already present in the master dictionary, </span>
                    <span class="c1"># append the value to the existing list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contact_ratios</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Merge the dictionaries</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">contact_areas_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_areas</span><span class="p">:</span>
                    <span class="c1"># If the key is not present in the master dictionary, </span>
                    <span class="c1"># create a new list with the current value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contact_areas</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the key is already present in the master dictionary, </span>
                    <span class="c1"># append the value to the existing list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contact_areas</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>
            
                <span class="c1"># print(self.contact_areas)</span>

<div class="viewcode-block" id="handler_class.adhesion_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.adhesion_handler">[docs]</a>    <span class="k">def</span> <span class="nf">adhesion_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for updating adhesion forces between cells.</span>

<span class="sd">        This method updates the location and parameters of adhesion forces </span>
<span class="sd">        between cells. Adhesion forces are adapted to the size of the </span>
<span class="sd">        corresponding cells, and the force location is set to the center </span>
<span class="sd">        of mass of each associated cell.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">force_list</span> <span class="o">=</span> <span class="n">Force</span><span class="o">.</span><span class="n">force_list</span>

        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">force_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;motion&#39;</span><span class="p">]:</span> 
                <span class="c1"># Retrieve objects of interest</span>
                <span class="n">assoc_cell</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">associated_cell</span>
                <span class="n">cell_obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">assoc_cell</span><span class="p">]</span>
                <span class="n">force_obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">cell_obj</span>

                <span class="c1"># Update the force location to its corresponding cell&#39;s center of mass</span>
                <span class="n">COM</span> <span class="o">=</span> <span class="n">get_centerofmass</span><span class="p">(</span><span class="n">cell_obj</span><span class="p">)</span>
                <span class="n">force_obj</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">COM</span>
                <span class="c1"># Adapt the radius of the force field to match with cell size</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">len_long_axis</span> <span class="o">=</span> <span class="n">get_long_axis_global</span><span class="p">(</span><span class="n">cell_obj</span><span class="p">)</span>                
                <span class="n">force_obj</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">distance_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">len_long_axis</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span>

                <span class="c1"># cell type: </span>
                <span class="c1"># cells will only adhere with cells from the same collection</span>
                <span class="n">cloth_modifier</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">assoc_cell</span><span class="p">]</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="s2">&quot;Cloth&quot;</span><span class="p">]</span>
                <span class="n">cloth_settings</span> <span class="o">=</span> <span class="n">cloth_modifier</span><span class="o">.</span><span class="n">settings</span>
                <span class="n">cloth_collection</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">assoc_cell</span><span class="p">]</span><span class="o">.</span><span class="n">users_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cloth_settings</span><span class="o">.</span><span class="n">effector_weights</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">cloth_collection</span></div>

<div class="viewcode-block" id="handler_class.data_export_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.data_export_handler">[docs]</a>    <span class="k">def</span> <span class="nf">data_export_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for exporting simulation data.</span>

<span class="sd">        This method writes various simulation data to JSON files at the end of </span>
<span class="sd">        the simulation.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">)</span>
        <span class="c1"># Write the list at the end of the simulation</span>
        <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_times.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_frame_cells.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_contact_ratios.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_ratios</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_msd.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msd</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_sorting_scores.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorting_scores</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_speed.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_motion_path.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_path</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_contact_areas.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_areas</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_volumes.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_pressures.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressures</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span><span class="si">}</span><span class="s2">_seed.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                    <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;subprocess.run([</span>
<span class="sd">                &quot;python&quot;,</span>
<span class="sd">                &quot;C:\\Users\\anr9744\\Projects\\Goo\\scripts\\modules\\goo\\visualization.py&quot;,</span>
<span class="sd">                f&quot;{self.data_file_path}&quot;</span>
<span class="sd">            ])&#39;&#39;&#39;</span></div>

    <span class="c1"># not used</span>
<div class="viewcode-block" id="handler_class.visualize_stretching"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.visualize_stretching">[docs]</a>    <span class="k">def</span> <span class="nf">visualize_stretching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span> 
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span> 
            <span class="k">if</span> <span class="s2">&quot;object&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cell&quot;</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># Make sure the object is a mesh</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;MESH&#39;</span><span class="p">:</span>
                <span class="c1"># Duplicate the object and apply all modifiers</span>
                <span class="n">mesh_eval</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>

                <span class="c1"># Get the vertex coordinates of the original mesh</span>
                <span class="n">vertices_original</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">co</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">]</span>

                <span class="c1"># Calculate stretching ratio for each vertex</span>
                <span class="n">stretching_ratios</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">vert_original</span><span class="p">,</span> <span class="n">vert_evaluated</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">vertices_original</span><span class="p">,</span> <span class="n">mesh_eval</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span>
                <span class="p">):</span>
                    <span class="n">stretching_ratio</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">vert_evaluated</span><span class="o">.</span><span class="n">co</span> <span class="o">-</span> <span class="n">vert_original</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> 
                        <span class="n">vert_original</span><span class="o">.</span><span class="n">length</span>
                    <span class="p">)</span>
                    <span class="n">stretching_ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stretching_ratio</span><span class="p">)</span>

                <span class="c1"># Normalize the stretching ratios</span>
                <span class="n">max_ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stretching_ratios</span><span class="p">)</span>
                <span class="n">normalized_ratios</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ratio</span> <span class="o">/</span> <span class="n">max_ratio</span> <span class="k">if</span> <span class="n">max_ratio</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> 
                    <span class="k">for</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">stretching_ratios</span>
                <span class="p">]</span>
                <span class="c1"># print(normalized_ratios)</span>

                <span class="c1"># Create a new vertex color layer if it doesn&#39;t exist</span>
                <span class="n">color_layer</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertex_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;StretchingRatio&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">color_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color_layer</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertex_colors</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;StretchingRatio&quot;</span><span class="p">)</span>

                <span class="c1"># Set vertex colors based on stretching ratio (gray to red gradient)</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">loop_index</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">loop_indices</span><span class="p">:</span>
                        <span class="n">vertex_index</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loops</span><span class="p">[</span><span class="n">loop_index</span><span class="p">]</span><span class="o">.</span><span class="n">vertex_index</span>
                        <span class="n">stretching_ratio</span> <span class="o">=</span> <span class="n">normalized_ratios</span><span class="p">[</span><span class="n">vertex_index</span><span class="p">]</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">stretching_ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Red-scale coloring</span>
                        <span class="n">color_layer</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loop_index</span><span class="p">]</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>

                <span class="c1"># Create a new material and assign it to the object</span>
                <span class="n">material</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;StretchingMaterial&quot;</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>

                <span class="c1"># Create a material slot for the object and link the material</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">material</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>

                <span class="c1"># Set up vertex colors for the material</span>
                <span class="n">material</span><span class="o">.</span><span class="n">use_nodes</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">vertex_color_node</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeVertexColor&#39;</span>
                <span class="p">)</span>
                <span class="n">shader_node_output</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeOutputMaterial&#39;</span>
                <span class="p">)</span>
                <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                    <span class="n">vertex_color_node</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Color&quot;</span><span class="p">],</span> 
                    <span class="n">shader_node_output</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Surface&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                
                <span class="c1"># Update the mesh to reflect the color changes</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object is not a mesh or not found.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="handler_class.timing_init_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.timing_init_handler">[docs]</a>    <span class="k">def</span> <span class="nf">timing_init_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes timing at the start of rendering.</span>

<span class="sd">        This method is called when the rendering starts for Frame 1.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Render started for Frame 1 at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="handler_class.timing_elapsed_handler"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.timing_elapsed_handler">[docs]</a>    <span class="k">def</span> <span class="nf">timing_elapsed_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible for timing each frame during rendering.</span>

<span class="sd">        This method is called for each frame after the rendering is completed. </span>
<span class="sd">        It is used to calculate the computational cost of each time step during </span>
<span class="sd">        rendering.</span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frame_written</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span>
        <span class="k">if</span> <span class="n">frame_written</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span> 
            <span class="n">elpased_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="n">elapsed_time_secs</span> <span class="o">=</span> <span class="n">elpased_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">elpased_time</span><span class="o">.</span><span class="n">microseconds</span><span class="o">/</span><span class="mi">1000000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">frame_written</span><span class="p">:</span> <span class="n">elapsed_time_secs</span><span class="p">})</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________________________________________________&#39;</span><span class="p">)</span>
            <span class="c1"># print(f&quot;Render Started at:{self.time}&quot;)  </span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current frame: </span><span class="si">{</span><span class="n">frame_written</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elapsed in seconds/microseconds:</span><span class="si">{</span><span class="n">elapsed_time_secs</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">;&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">elapsed_time_secs</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span> 
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span> 
            <span class="k">if</span> <span class="s2">&quot;object&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cell&quot;</span>
            <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">frame_written</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Initialize list if not present</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initialize list if not present</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_cells</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_written</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">frame_written</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span> </div>

<div class="viewcode-block" id="handler_class.stop_animation"><a class="viewcode-back" href="../../user_guide/goo.html#goo.goo.handler_class.stop_animation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">depsgraph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler responsible to stop the simulation.</span>

<span class="sd">        This method is called for each frame after the rendering is completed, </span>
<span class="sd">        and is executed only at the last time step. </span>
<span class="sd">        May be toggled to automatically quit Blender when the simulation is completed, </span>
<span class="sd">        which is needed when scanning parameter spaces. </span>

<span class="sd">        :param scene: The Blender scene object.</span>
<span class="sd">        :param depsgraph: The dependency graph object.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># checks if the simulation has ended</span>
        <span class="k">if</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame_current</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation has ended.&quot;</span><span class="p">)</span>
            <span class="c1"># True enables the last frame not to be repeated</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">animation_cancel</span><span class="p">(</span><span class="n">restore_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </div></div>
            <span class="c1"># closes Blender then</span>
            <span class="c1"># bpy.ops.wm.quit_blender()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Antoine Ruzette, Sean Megason.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>